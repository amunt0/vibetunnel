var ri=Object.create;var Ue=Object.defineProperty;var wt=Object.getOwnPropertyDescriptor;var si=Object.getOwnPropertyNames;var ni=Object.getPrototypeOf,oi=Object.prototype.hasOwnProperty;var at=(S,i)=>()=>(S&&(i=S(S=0)),i);var ai=(S,i)=>()=>(i||S((i={exports:{}}).exports,i),i.exports),hi=(S,i)=>{for(var e in i)Ue(S,e,{get:i[e],enumerable:!0})},li=(S,i,e,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of si(i))!oi.call(S,d)&&d!==e&&Ue(S,d,{get:()=>i[d],enumerable:!(n=wt(i,d))||n.enumerable});return S};var ci=(S,i,e)=>(e=S!=null?ri(ni(S)):{},li(i||!S||!S.__esModule?Ue(e,"default",{value:S,enumerable:!0}):e,S));var O=(S,i,e,n)=>{for(var d=n>1?void 0:n?wt(i,e):i,b=S.length-1,y;b>=0;b--)(y=S[b])&&(d=(n?y(i,e,d):y(d))||d);return n&&d&&Ue(i,e,d),d};var jt=ai(qt=>{(()=>{"use strict";var S={349:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;let _=l(460),p=l(844);class s extends p.Disposable{constructor(c){super(),this._maxLength=c,this.onDeleteEmitter=this.register(new _.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new _.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new _.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(c){if(this._maxLength===c)return;let u=new Array(c);for(let m=0;m<Math.min(c,this.length);m++)u[m]=this._array[this._getCyclicIndex(m)];this._array=u,this._maxLength=c,this._startIndex=0}get length(){return this._length}set length(c){if(c>this._length)for(let u=this._length;u<c;u++)this._array[u]=void 0;this._length=c}get(c){return this._array[this._getCyclicIndex(c)]}set(c,u){this._array[this._getCyclicIndex(c)]=u}push(c){this._array[this._getCyclicIndex(this._length)]=c,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(c,u,...m){if(u){for(let t=c;t<this._length-u;t++)this._array[this._getCyclicIndex(t)]=this._array[this._getCyclicIndex(t+u)];this._length-=u,this.onDeleteEmitter.fire({index:c,amount:u})}for(let t=this._length-1;t>=c;t--)this._array[this._getCyclicIndex(t+m.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<m.length;t++)this._array[this._getCyclicIndex(c+t)]=m[t];if(m.length&&this.onInsertEmitter.fire({index:c,amount:m.length}),this._length+m.length>this._maxLength){let t=this._length+m.length-this._maxLength;this._startIndex+=t,this._length=this._maxLength,this.onTrimEmitter.fire(t)}else this._length+=m.length}trimStart(c){c>this._length&&(c=this._length),this._startIndex+=c,this._length-=c,this.onTrimEmitter.fire(c)}shiftElements(c,u,m){if(!(u<=0)){if(c<0||c>=this._length)throw new Error("start argument out of range");if(c+m<0)throw new Error("Cannot shift elements in list beyond index 0");if(m>0){for(let o=u-1;o>=0;o--)this.set(c+o+m,this.get(c+o));let t=c+u+m-this._length;if(t>0)for(this._length+=t;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let t=0;t<u;t++)this.set(c+t+m,this.get(c+t))}}_getCyclicIndex(c){return(this._startIndex+c)%this._maxLength}}r.CircularList=s},439:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function l(_,p=5){if(typeof _!="object")return _;let s=Array.isArray(_)?[]:{};for(let f in _)s[f]=p<=1?_[f]:_[f]&&l(_[f],p-1);return s}},969:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;let _=l(844),p=l(585),s=l(348),f=l(866),c=l(744),u=l(302),m=l(83),t=l(460),o=l(753),h=l(480),a=l(994),v=l(282),w=l(435),T=l(981),L=l(660),k=!1;class R extends _.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new t.EventEmitter),this._onScroll.event(M=>{this._onScrollApi?.fire(M.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(M){for(let B in M)this.optionsService.options[B]=M[B]}constructor(M){super(),this._windowsWrappingHeuristics=this.register(new _.MutableDisposable),this._onBinary=this.register(new t.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new t.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new t.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new t.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new t.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new t.EventEmitter),this._instantiationService=new s.InstantiationService,this.optionsService=this.register(new u.OptionsService(M)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(c.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(m.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(o.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(h.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(a.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(L.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new w.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,t.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,t.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,t.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,t.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new T.WriteBuffer((B,D)=>this._inputHandler.parse(B,D))),this.register((0,t.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(M,B){this._writeBuffer.write(M,B)}writeSync(M,B){this._logService.logLevel<=p.LogLevelEnum.WARN&&!k&&(this._logService.warn("writeSync is unreliable and will be removed soon."),k=!0),this._writeBuffer.writeSync(M,B)}input(M,B=!0){this.coreService.triggerDataEvent(M,B)}resize(M,B){isNaN(M)||isNaN(B)||(M=Math.max(M,c.MINIMUM_COLS),B=Math.max(B,c.MINIMUM_ROWS),this._bufferService.resize(M,B))}scroll(M,B=!1){this._bufferService.scroll(M,B)}scrollLines(M,B,D){this._bufferService.scrollLines(M,B,D)}scrollPages(M){this.scrollLines(M*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(M){let B=M-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(M,B){return this._inputHandler.registerEscHandler(M,B)}registerDcsHandler(M,B){return this._inputHandler.registerDcsHandler(M,B)}registerCsiHandler(M,B){return this._inputHandler.registerCsiHandler(M,B)}registerOscHandler(M,B){return this._inputHandler.registerOscHandler(M,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let M=!1,B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?M=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(M=!0),M?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let M=[];M.push(this.onLineFeed(v.updateWindowsModeWrappedState.bind(null,this._bufferService))),M.push(this.registerCsiHandler({final:"H"},()=>((0,v.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,_.toDisposable)(()=>{for(let B of M)B.dispose()})}}}r.CoreTerminal=R},460:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=l=>(this._listeners.push(l),{dispose:()=>{if(!this._disposed){for(let p=0;p<this._listeners.length;p++)if(this._listeners[p]===l)return void this._listeners.splice(p,1)}}})),this._event}fire(l,_){let p=[];for(let s=0;s<this._listeners.length;s++)p.push(this._listeners[s]);for(let s=0;s<p.length;s++)p[s].call(void 0,l,_)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(l,_){return l(p=>_.fire(p))},r.runAndSubscribe=function(l,_){return _(void 0),l(p=>_(p))}},435:function(y,r,l){var _=this&&this.__decorate||function(I,g,A,C){var x,P=arguments.length,$=P<3?g:C===null?C=Object.getOwnPropertyDescriptor(g,A):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(I,g,A,C);else for(var W=I.length-1;W>=0;W--)(x=I[W])&&($=(P<3?x($):P>3?x(g,A,$):x(g,A))||$);return P>3&&$&&Object.defineProperty(g,A,$),$},p=this&&this.__param||function(I,g){return function(A,C){g(A,C,I)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;let s=l(584),f=l(116),c=l(15),u=l(844),m=l(482),t=l(437),o=l(460),h=l(643),a=l(511),v=l(734),w=l(585),T=l(480),L=l(242),k=l(351),R=l(941),q={"(":0,")":1,"*":2,"+":3,"-":1,".":2},M=131072;function B(I,g){if(I>24)return g.setWinLines||!1;switch(I){case 1:return!!g.restoreWin;case 2:return!!g.minimizeWin;case 3:return!!g.setWinPosition;case 4:return!!g.setWinSizePixels;case 5:return!!g.raiseWin;case 6:return!!g.lowerWin;case 7:return!!g.refreshWin;case 8:return!!g.setWinSizeChars;case 9:return!!g.maximizeWin;case 10:return!!g.fullscreenWin;case 11:return!!g.getWinState;case 13:return!!g.getWinPosition;case 14:return!!g.getWinSizePixels;case 15:return!!g.getScreenSizePixels;case 16:return!!g.getCellSizePixels;case 18:return!!g.getWinSizeChars;case 19:return!!g.getScreenSizeChars;case 20:return!!g.getIconTitle;case 21:return!!g.getWinTitle;case 22:return!!g.pushTitle;case 23:return!!g.popTitle;case 24:return!!g.setWinLines}return!1}var D;(function(I){I[I.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",I[I.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(D||(r.WindowsOptionsReportType=D={}));let se=0;class ee extends u.Disposable{getAttrData(){return this._curAttrData}constructor(g,A,C,x,P,$,W,j,te=new c.EscapeSequenceParser){super(),this._bufferService=g,this._charsetService=A,this._coreService=C,this._logService=x,this._optionsService=P,this._oscLinkService=$,this._coreMouseService=W,this._unicodeService=j,this._parser=te,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new m.StringToUtf32,this._utf8Decoder=new m.Utf8ToUtf32,this._workCell=new a.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=t.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new o.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new o.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new o.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new o.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new o.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new o.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new o.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new o.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new o.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new o.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new o.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new o.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new N(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(E=>this._activeBuffer=E.activeBuffer)),this._parser.setCsiHandlerFallback((E,F)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(E),params:F.toArray()})}),this._parser.setEscHandlerFallback(E=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(E)})}),this._parser.setExecuteHandlerFallback(E=>{this._logService.debug("Unknown EXECUTE code: ",{code:E})}),this._parser.setOscHandlerFallback((E,F,H)=>{this._logService.debug("Unknown OSC code: ",{identifier:E,action:F,data:H})}),this._parser.setDcsHandlerFallback((E,F,H)=>{F==="HOOK"&&(H=H.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(E),action:F,payload:H})}),this._parser.setPrintHandler((E,F,H)=>this.print(E,F,H)),this._parser.registerCsiHandler({final:"@"},E=>this.insertChars(E)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},E=>this.scrollLeft(E)),this._parser.registerCsiHandler({final:"A"},E=>this.cursorUp(E)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},E=>this.scrollRight(E)),this._parser.registerCsiHandler({final:"B"},E=>this.cursorDown(E)),this._parser.registerCsiHandler({final:"C"},E=>this.cursorForward(E)),this._parser.registerCsiHandler({final:"D"},E=>this.cursorBackward(E)),this._parser.registerCsiHandler({final:"E"},E=>this.cursorNextLine(E)),this._parser.registerCsiHandler({final:"F"},E=>this.cursorPrecedingLine(E)),this._parser.registerCsiHandler({final:"G"},E=>this.cursorCharAbsolute(E)),this._parser.registerCsiHandler({final:"H"},E=>this.cursorPosition(E)),this._parser.registerCsiHandler({final:"I"},E=>this.cursorForwardTab(E)),this._parser.registerCsiHandler({final:"J"},E=>this.eraseInDisplay(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},E=>this.eraseInDisplay(E,!0)),this._parser.registerCsiHandler({final:"K"},E=>this.eraseInLine(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},E=>this.eraseInLine(E,!0)),this._parser.registerCsiHandler({final:"L"},E=>this.insertLines(E)),this._parser.registerCsiHandler({final:"M"},E=>this.deleteLines(E)),this._parser.registerCsiHandler({final:"P"},E=>this.deleteChars(E)),this._parser.registerCsiHandler({final:"S"},E=>this.scrollUp(E)),this._parser.registerCsiHandler({final:"T"},E=>this.scrollDown(E)),this._parser.registerCsiHandler({final:"X"},E=>this.eraseChars(E)),this._parser.registerCsiHandler({final:"Z"},E=>this.cursorBackwardTab(E)),this._parser.registerCsiHandler({final:"`"},E=>this.charPosAbsolute(E)),this._parser.registerCsiHandler({final:"a"},E=>this.hPositionRelative(E)),this._parser.registerCsiHandler({final:"b"},E=>this.repeatPrecedingCharacter(E)),this._parser.registerCsiHandler({final:"c"},E=>this.sendDeviceAttributesPrimary(E)),this._parser.registerCsiHandler({prefix:">",final:"c"},E=>this.sendDeviceAttributesSecondary(E)),this._parser.registerCsiHandler({final:"d"},E=>this.linePosAbsolute(E)),this._parser.registerCsiHandler({final:"e"},E=>this.vPositionRelative(E)),this._parser.registerCsiHandler({final:"f"},E=>this.hVPosition(E)),this._parser.registerCsiHandler({final:"g"},E=>this.tabClear(E)),this._parser.registerCsiHandler({final:"h"},E=>this.setMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"h"},E=>this.setModePrivate(E)),this._parser.registerCsiHandler({final:"l"},E=>this.resetMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"l"},E=>this.resetModePrivate(E)),this._parser.registerCsiHandler({final:"m"},E=>this.charAttributes(E)),this._parser.registerCsiHandler({final:"n"},E=>this.deviceStatus(E)),this._parser.registerCsiHandler({prefix:"?",final:"n"},E=>this.deviceStatusPrivate(E)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},E=>this.softReset(E)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},E=>this.setCursorStyle(E)),this._parser.registerCsiHandler({final:"r"},E=>this.setScrollRegion(E)),this._parser.registerCsiHandler({final:"s"},E=>this.saveCursor(E)),this._parser.registerCsiHandler({final:"t"},E=>this.windowOptions(E)),this._parser.registerCsiHandler({final:"u"},E=>this.restoreCursor(E)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},E=>this.insertColumns(E)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},E=>this.deleteColumns(E)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},E=>this.selectProtected(E)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},E=>this.requestMode(E,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},E=>this.requestMode(E,!1)),this._parser.setExecuteHandler(s.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(s.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(s.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(s.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(s.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(s.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(s.C1.IND,()=>this.index()),this._parser.setExecuteHandler(s.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(s.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new L.OscHandler(E=>(this.setTitle(E),this.setIconName(E),!0))),this._parser.registerOscHandler(1,new L.OscHandler(E=>this.setIconName(E))),this._parser.registerOscHandler(2,new L.OscHandler(E=>this.setTitle(E))),this._parser.registerOscHandler(4,new L.OscHandler(E=>this.setOrReportIndexedColor(E))),this._parser.registerOscHandler(8,new L.OscHandler(E=>this.setHyperlink(E))),this._parser.registerOscHandler(10,new L.OscHandler(E=>this.setOrReportFgColor(E))),this._parser.registerOscHandler(11,new L.OscHandler(E=>this.setOrReportBgColor(E))),this._parser.registerOscHandler(12,new L.OscHandler(E=>this.setOrReportCursorColor(E))),this._parser.registerOscHandler(104,new L.OscHandler(E=>this.restoreIndexedColor(E))),this._parser.registerOscHandler(110,new L.OscHandler(E=>this.restoreFgColor(E))),this._parser.registerOscHandler(111,new L.OscHandler(E=>this.restoreBgColor(E))),this._parser.registerOscHandler(112,new L.OscHandler(E=>this.restoreCursorColor(E))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let E in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:E},()=>this.selectCharset("("+E)),this._parser.registerEscHandler({intermediates:")",final:E},()=>this.selectCharset(")"+E)),this._parser.registerEscHandler({intermediates:"*",final:E},()=>this.selectCharset("*"+E)),this._parser.registerEscHandler({intermediates:"+",final:E},()=>this.selectCharset("+"+E)),this._parser.registerEscHandler({intermediates:"-",final:E},()=>this.selectCharset("-"+E)),this._parser.registerEscHandler({intermediates:".",final:E},()=>this.selectCharset("."+E)),this._parser.registerEscHandler({intermediates:"/",final:E},()=>this.selectCharset("/"+E));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(E=>(this._logService.error("Parsing error: ",E),E)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new k.DcsHandler((E,F)=>this.requestStatusString(E,F)))}_preserveStack(g,A,C,x){this._parseStack.paused=!0,this._parseStack.cursorStartX=g,this._parseStack.cursorStartY=A,this._parseStack.decodedLength=C,this._parseStack.position=x}_logSlowResolvingAsync(g){this._logService.logLevel<=w.LogLevelEnum.WARN&&Promise.race([g,new Promise((A,C)=>setTimeout(()=>C("#SLOW_TIMEOUT"),5e3))]).catch(A=>{if(A!=="#SLOW_TIMEOUT")throw A;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(g,A){let C,x=this._activeBuffer.x,P=this._activeBuffer.y,$=0,W=this._parseStack.paused;if(W){if(C=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,A))return this._logSlowResolvingAsync(C),C;x=this._parseStack.cursorStartX,P=this._parseStack.cursorStartY,this._parseStack.paused=!1,g.length>M&&($=this._parseStack.position+M)}if(this._logService.logLevel<=w.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof g=="string"?` "${g}"`:` "${Array.prototype.map.call(g,E=>String.fromCharCode(E)).join("")}"`),typeof g=="string"?g.split("").map(E=>E.charCodeAt(0)):g),this._parseBuffer.length<g.length&&this._parseBuffer.length<M&&(this._parseBuffer=new Uint32Array(Math.min(g.length,M))),W||this._dirtyRowTracker.clearRange(),g.length>M)for(let E=$;E<g.length;E+=M){let F=E+M<g.length?E+M:g.length,H=typeof g=="string"?this._stringDecoder.decode(g.substring(E,F),this._parseBuffer):this._utf8Decoder.decode(g.subarray(E,F),this._parseBuffer);if(C=this._parser.parse(this._parseBuffer,H))return this._preserveStack(x,P,H,E),this._logSlowResolvingAsync(C),C}else if(!W){let E=typeof g=="string"?this._stringDecoder.decode(g,this._parseBuffer):this._utf8Decoder.decode(g,this._parseBuffer);if(C=this._parser.parse(this._parseBuffer,E))return this._preserveStack(x,P,E,0),this._logSlowResolvingAsync(C),C}this._activeBuffer.x===x&&this._activeBuffer.y===P||this._onCursorMove.fire();let j=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),te=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);te<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(te,this._bufferService.rows-1),Math.min(j,this._bufferService.rows-1))}print(g,A,C){let x,P,$=this._charsetService.charset,W=this._optionsService.rawOptions.screenReaderMode,j=this._bufferService.cols,te=this._coreService.decPrivateModes.wraparound,E=this._coreService.modes.insertMode,F=this._curAttrData,H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&C-A>0&&H.getWidth(this._activeBuffer.x-1)===2&&H.setCellFromCodepoint(this._activeBuffer.x-1,0,1,F);let U=this._parser.precedingJoinState;for(let ye=A;ye<C;++ye){if(x=g[ye],x<127&&$){let ue=$[String.fromCharCode(x)];ue&&(x=ue.charCodeAt(0))}let Se=this._unicodeService.charProperties(x,U);P=T.UnicodeService.extractWidth(Se);let Ie=T.UnicodeService.extractShouldJoin(Se),de=Ie?T.UnicodeService.extractWidth(U):0;if(U=Se,W&&this._onA11yChar.fire((0,m.stringFromCodePoint)(x)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+P-de>j){if(te){let ue=H,Ae=this._activeBuffer.x-de;for(this._activeBuffer.x=de,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),de>0&&H instanceof t.BufferLine&&H.copyCellsFrom(ue,Ae,0,de,!1);Ae<j;)ue.setCellFromCodepoint(Ae++,0,1,F)}else if(this._activeBuffer.x=j-1,P===2)continue}if(Ie&&this._activeBuffer.x){let ue=H.getWidth(this._activeBuffer.x-1)?1:2;H.addCodepointToCell(this._activeBuffer.x-ue,x,P);for(let Ae=P-de;--Ae>=0;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,F)}else if(E&&(H.insertCells(this._activeBuffer.x,P-de,this._activeBuffer.getNullCell(F)),H.getWidth(j-1)===2&&H.setCellFromCodepoint(j-1,h.NULL_CELL_CODE,h.NULL_CELL_WIDTH,F)),H.setCellFromCodepoint(this._activeBuffer.x++,x,P,F),P>0)for(;--P;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,F)}this._parser.precedingJoinState=U,this._activeBuffer.x<j&&C-A>0&&H.getWidth(this._activeBuffer.x)===0&&!H.hasContent(this._activeBuffer.x)&&H.setCellFromCodepoint(this._activeBuffer.x,0,1,F),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(g,A){return g.final!=="t"||g.prefix||g.intermediates?this._parser.registerCsiHandler(g,A):this._parser.registerCsiHandler(g,C=>!B(C.params[0],this._optionsService.rawOptions.windowOptions)||A(C))}registerDcsHandler(g,A){return this._parser.registerDcsHandler(g,new k.DcsHandler(A))}registerEscHandler(g,A){return this._parser.registerEscHandler(g,A)}registerOscHandler(g,A){return this._parser.registerOscHandler(g,new L.OscHandler(A))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let g=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);g.hasWidth(this._activeBuffer.x)&&!g.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let g=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-g),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(g=this._bufferService.cols-1){this._activeBuffer.x=Math.min(g,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(g,A){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=g,this._activeBuffer.y=this._activeBuffer.scrollTop+A):(this._activeBuffer.x=g,this._activeBuffer.y=A),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(g,A){this._restrictCursor(),this._setCursor(this._activeBuffer.x+g,this._activeBuffer.y+A)}cursorUp(g){let A=this._activeBuffer.y-this._activeBuffer.scrollTop;return A>=0?this._moveCursor(0,-Math.min(A,g.params[0]||1)):this._moveCursor(0,-(g.params[0]||1)),!0}cursorDown(g){let A=this._activeBuffer.scrollBottom-this._activeBuffer.y;return A>=0?this._moveCursor(0,Math.min(A,g.params[0]||1)):this._moveCursor(0,g.params[0]||1),!0}cursorForward(g){return this._moveCursor(g.params[0]||1,0),!0}cursorBackward(g){return this._moveCursor(-(g.params[0]||1),0),!0}cursorNextLine(g){return this.cursorDown(g),this._activeBuffer.x=0,!0}cursorPrecedingLine(g){return this.cursorUp(g),this._activeBuffer.x=0,!0}cursorCharAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(g){return this._setCursor(g.length>=2?(g.params[1]||1)-1:0,(g.params[0]||1)-1),!0}charPosAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(g){return this._moveCursor(g.params[0]||1,0),!0}linePosAbsolute(g){return this._setCursor(this._activeBuffer.x,(g.params[0]||1)-1),!0}vPositionRelative(g){return this._moveCursor(0,g.params[0]||1),!0}hVPosition(g){return this.cursorPosition(g),!0}tabClear(g){let A=g.params[0];return A===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:A===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let A=g.params[0]||1;for(;A--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let A=g.params[0]||1;for(;A--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(g){let A=g.params[0];return A===1&&(this._curAttrData.bg|=536870912),A!==2&&A!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(g,A,C,x=!1,P=!1){let $=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);$.replaceCells(A,C,this._activeBuffer.getNullCell(this._eraseAttrData()),P),x&&($.isWrapped=!1)}_resetBufferLine(g,A=!1){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C&&(C.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),A),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+g),C.isWrapped=!1)}eraseInDisplay(g,A=!1){let C;switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:for(C=this._activeBuffer.y,this._dirtyRowTracker.markDirty(C),this._eraseInBufferLine(C++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,A);C<this._bufferService.rows;C++)this._resetBufferLine(C,A);this._dirtyRowTracker.markDirty(C);break;case 1:for(C=this._activeBuffer.y,this._dirtyRowTracker.markDirty(C),this._eraseInBufferLine(C,0,this._activeBuffer.x+1,!0,A),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(C+1).isWrapped=!1);C--;)this._resetBufferLine(C,A);this._dirtyRowTracker.markDirty(0);break;case 2:for(C=this._bufferService.rows,this._dirtyRowTracker.markDirty(C-1);C--;)this._resetBufferLine(C,A);this._dirtyRowTracker.markDirty(0);break;case 3:let x=this._activeBuffer.lines.length-this._bufferService.rows;x>0&&(this._activeBuffer.lines.trimStart(x),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-x,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-x,0),this._onScroll.fire(0))}return!0}eraseInLine(g,A=!1){switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,A);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,A);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,A)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(g){this._restrictCursor();let A=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let C=this._activeBuffer.ybase+this._activeBuffer.y,x=this._bufferService.rows-1-this._activeBuffer.scrollBottom,P=this._bufferService.rows-1+this._activeBuffer.ybase-x+1;for(;A--;)this._activeBuffer.lines.splice(P-1,1),this._activeBuffer.lines.splice(C,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(g){this._restrictCursor();let A=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let C=this._activeBuffer.ybase+this._activeBuffer.y,x;for(x=this._bufferService.rows-1-this._activeBuffer.scrollBottom,x=this._bufferService.rows-1+this._activeBuffer.ybase-x;A--;)this._activeBuffer.lines.splice(C,1),this._activeBuffer.lines.splice(x,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(g){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.insertCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(g){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.deleteCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(g){let A=g.params[0]||1;for(;A--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(g){let A=g.params[0]||1;for(;A--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(t.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=g.params[0]||1;for(let C=this._activeBuffer.scrollTop;C<=this._activeBuffer.scrollBottom;++C){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);x.deleteCells(0,A,this._activeBuffer.getNullCell(this._eraseAttrData())),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=g.params[0]||1;for(let C=this._activeBuffer.scrollTop;C<=this._activeBuffer.scrollBottom;++C){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);x.insertCells(0,A,this._activeBuffer.getNullCell(this._eraseAttrData())),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=g.params[0]||1;for(let C=this._activeBuffer.scrollTop;C<=this._activeBuffer.scrollBottom;++C){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);x.insertCells(this._activeBuffer.x,A,this._activeBuffer.getNullCell(this._eraseAttrData())),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=g.params[0]||1;for(let C=this._activeBuffer.scrollTop;C<=this._activeBuffer.scrollBottom;++C){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);x.deleteCells(this._activeBuffer.x,A,this._activeBuffer.getNullCell(this._eraseAttrData())),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(g){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(g.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(g){let A=this._parser.precedingJoinState;if(!A)return!0;let C=g.params[0]||1,x=T.UnicodeService.extractWidth(A),P=this._activeBuffer.x-x,$=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(P),W=new Uint32Array($.length*C),j=0;for(let E=0;E<$.length;){let F=$.codePointAt(E)||0;W[j++]=F,E+=F>65535?2:1}let te=j;for(let E=1;E<C;++E)W.copyWithin(te,0,j),te+=j;return this.print(W,0,te),!0}sendDeviceAttributesPrimary(g){return g.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(s.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(s.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(g){return g.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(s.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(s.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(g.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(s.C0.ESC+"[>83;40003;0c")),!0}_is(g){return(this._optionsService.rawOptions.termName+"").indexOf(g)===0}setMode(g){for(let A=0;A<g.length;A++)switch(g.params[A]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(g){for(let A=0;A<g.length;A++)switch(g.params[A]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(g){for(let A=0;A<g.length;A++)switch(g.params[A]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(g){for(let A=0;A<g.length;A++)switch(g.params[A]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),g.params[A]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(g,A){let C=this._coreService.decPrivateModes,{activeProtocol:x,activeEncoding:P}=this._coreMouseService,$=this._coreService,{buffers:W,cols:j}=this._bufferService,{active:te,alt:E}=W,F=this._optionsService.rawOptions,H=Ie=>Ie?1:2,U=g.params[0];return ye=U,Se=A?U===2?4:U===4?H($.modes.insertMode):U===12?3:U===20?H(F.convertEol):0:U===1?H(C.applicationCursorKeys):U===3?F.windowOptions.setWinLines?j===80?2:j===132?1:0:0:U===6?H(C.origin):U===7?H(C.wraparound):U===8?3:U===9?H(x==="X10"):U===12?H(F.cursorBlink):U===25?H(!$.isCursorHidden):U===45?H(C.reverseWraparound):U===66?H(C.applicationKeypad):U===67?4:U===1e3?H(x==="VT200"):U===1002?H(x==="DRAG"):U===1003?H(x==="ANY"):U===1004?H(C.sendFocus):U===1005?4:U===1006?H(P==="SGR"):U===1015?4:U===1016?H(P==="SGR_PIXELS"):U===1048?1:U===47||U===1047||U===1049?H(te===E):U===2004?H(C.bracketedPasteMode):0,$.triggerDataEvent(`${s.C0.ESC}[${A?"":"?"}${ye};${Se}$y`),!0;var ye,Se}_updateAttrColor(g,A,C,x,P){return A===2?(g|=50331648,g&=-16777216,g|=v.AttributeData.fromColorRGB([C,x,P])):A===5&&(g&=-50331904,g|=33554432|255&C),g}_extractColor(g,A,C){let x=[0,0,-1,0,0,0],P=0,$=0;do{if(x[$+P]=g.params[A+$],g.hasSubParams(A+$)){let W=g.getSubParams(A+$),j=0;do x[1]===5&&(P=1),x[$+j+1+P]=W[j];while(++j<W.length&&j+$+1+P<x.length);break}if(x[1]===5&&$+P>=2||x[1]===2&&$+P>=5)break;x[1]&&(P=1)}while(++$+A<g.length&&$+P<x.length);for(let W=2;W<x.length;++W)x[W]===-1&&(x[W]=0);switch(x[0]){case 38:C.fg=this._updateAttrColor(C.fg,x[1],x[3],x[4],x[5]);break;case 48:C.bg=this._updateAttrColor(C.bg,x[1],x[3],x[4],x[5]);break;case 58:C.extended=C.extended.clone(),C.extended.underlineColor=this._updateAttrColor(C.extended.underlineColor,x[1],x[3],x[4],x[5])}return $}_processUnderline(g,A){A.extended=A.extended.clone(),(!~g||g>5)&&(g=1),A.extended.underlineStyle=g,A.fg|=268435456,g===0&&(A.fg&=-268435457),A.updateExtended()}_processSGR0(g){g.fg=t.DEFAULT_ATTR_DATA.fg,g.bg=t.DEFAULT_ATTR_DATA.bg,g.extended=g.extended.clone(),g.extended.underlineStyle=0,g.extended.underlineColor&=-67108864,g.updateExtended()}charAttributes(g){if(g.length===1&&g.params[0]===0)return this._processSGR0(this._curAttrData),!0;let A=g.length,C,x=this._curAttrData;for(let P=0;P<A;P++)C=g.params[P],C>=30&&C<=37?(x.fg&=-50331904,x.fg|=16777216|C-30):C>=40&&C<=47?(x.bg&=-50331904,x.bg|=16777216|C-40):C>=90&&C<=97?(x.fg&=-50331904,x.fg|=16777224|C-90):C>=100&&C<=107?(x.bg&=-50331904,x.bg|=16777224|C-100):C===0?this._processSGR0(x):C===1?x.fg|=134217728:C===3?x.bg|=67108864:C===4?(x.fg|=268435456,this._processUnderline(g.hasSubParams(P)?g.getSubParams(P)[0]:1,x)):C===5?x.fg|=536870912:C===7?x.fg|=67108864:C===8?x.fg|=1073741824:C===9?x.fg|=2147483648:C===2?x.bg|=134217728:C===21?this._processUnderline(2,x):C===22?(x.fg&=-134217729,x.bg&=-134217729):C===23?x.bg&=-67108865:C===24?(x.fg&=-268435457,this._processUnderline(0,x)):C===25?x.fg&=-536870913:C===27?x.fg&=-67108865:C===28?x.fg&=-1073741825:C===29?x.fg&=2147483647:C===39?(x.fg&=-67108864,x.fg|=16777215&t.DEFAULT_ATTR_DATA.fg):C===49?(x.bg&=-67108864,x.bg|=16777215&t.DEFAULT_ATTR_DATA.bg):C===38||C===48||C===58?P+=this._extractColor(g,P,x):C===53?x.bg|=1073741824:C===55?x.bg&=-1073741825:C===59?(x.extended=x.extended.clone(),x.extended.underlineColor=-1,x.updateExtended()):C===100?(x.fg&=-67108864,x.fg|=16777215&t.DEFAULT_ATTR_DATA.fg,x.bg&=-67108864,x.bg|=16777215&t.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",C);return!0}deviceStatus(g){switch(g.params[0]){case 5:this._coreService.triggerDataEvent(`${s.C0.ESC}[0n`);break;case 6:let A=this._activeBuffer.y+1,C=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[${A};${C}R`)}return!0}deviceStatusPrivate(g){if(g.params[0]===6){let A=this._activeBuffer.y+1,C=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[?${A};${C}R`)}return!0}softReset(g){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(g){let A=g.params[0]||1;switch(A){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let C=A%2==1;return this._optionsService.options.cursorBlink=C,!0}setScrollRegion(g){let A=g.params[0]||1,C;return(g.length<2||(C=g.params[1])>this._bufferService.rows||C===0)&&(C=this._bufferService.rows),C>A&&(this._activeBuffer.scrollTop=A-1,this._activeBuffer.scrollBottom=C-1,this._setCursor(0,0)),!0}windowOptions(g){if(!B(g.params[0],this._optionsService.rawOptions.windowOptions))return!0;let A=g.length>1?g.params[1]:0;switch(g.params[0]){case 14:A!==2&&this._onRequestWindowsOptionsReport.fire(D.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(D.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${s.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:A!==0&&A!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),A!==0&&A!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:A!==0&&A!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),A!==0&&A!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(g){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(g){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(g){return this._windowTitle=g,this._onTitleChange.fire(g),!0}setIconName(g){return this._iconName=g,!0}setOrReportIndexedColor(g){let A=[],C=g.split(";");for(;C.length>1;){let x=C.shift(),P=C.shift();if(/^\d+$/.exec(x)){let $=parseInt(x);if(J($))if(P==="?")A.push({type:0,index:$});else{let W=(0,R.parseColor)(P);W&&A.push({type:1,index:$,color:W})}}}return A.length&&this._onColor.fire(A),!0}setHyperlink(g){let A=g.split(";");return!(A.length<2)&&(A[1]?this._createHyperlink(A[0],A[1]):!A[0]&&this._finishHyperlink())}_createHyperlink(g,A){this._getCurrentLinkId()&&this._finishHyperlink();let C=g.split(":"),x,P=C.findIndex($=>$.startsWith("id="));return P!==-1&&(x=C[P].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:x,uri:A}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(g,A){let C=g.split(";");for(let x=0;x<C.length&&!(A>=this._specialColors.length);++x,++A)if(C[x]==="?")this._onColor.fire([{type:0,index:this._specialColors[A]}]);else{let P=(0,R.parseColor)(C[x]);P&&this._onColor.fire([{type:1,index:this._specialColors[A],color:P}])}return!0}setOrReportFgColor(g){return this._setOrReportSpecialColor(g,0)}setOrReportBgColor(g){return this._setOrReportSpecialColor(g,1)}setOrReportCursorColor(g){return this._setOrReportSpecialColor(g,2)}restoreIndexedColor(g){if(!g)return this._onColor.fire([{type:2}]),!0;let A=[],C=g.split(";");for(let x=0;x<C.length;++x)if(/^\d+$/.exec(C[x])){let P=parseInt(C[x]);J(P)&&A.push({type:2,index:P})}return A.length&&this._onColor.fire(A),!0}restoreFgColor(g){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(g){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(g){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(g){return g.length!==2?(this.selectDefaultCharset(),!0):(g[0]==="/"||this._charsetService.setgCharset(q[g[0]],f.CHARSETS[g[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let g=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,g,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=t.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(g){return this._charsetService.setgLevel(g),!0}screenAlignmentPattern(){let g=new a.CellData;g.content=4194373,g.fg=this._curAttrData.fg,g.bg=this._curAttrData.bg,this._setCursor(0,0);for(let A=0;A<this._bufferService.rows;++A){let C=this._activeBuffer.ybase+this._activeBuffer.y+A,x=this._activeBuffer.lines.get(C);x&&(x.fill(g),x.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(g,A){let C=this._bufferService.buffer,x=this._optionsService.rawOptions;return(P=>(this._coreService.triggerDataEvent(`${s.C0.ESC}${P}${s.C0.ESC}\\`),!0))(g==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:g==='"p'?'P1$r61;1"p':g==="r"?`P1$r${C.scrollTop+1};${C.scrollBottom+1}r`:g==="m"?"P1$r0m":g===" q"?`P1$r${{block:2,underline:4,bar:6}[x.cursorStyle]-(x.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(g,A){this._dirtyRowTracker.markRangeDirty(g,A)}}r.InputHandler=ee;let N=class{constructor(I){this._bufferService=I,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(I){I<this.start?this.start=I:I>this.end&&(this.end=I)}markRangeDirty(I,g){I>g&&(se=I,I=g,g=se),I<this.start&&(this.start=I),g>this.end&&(this.end=g)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function J(I){return 0<=I&&I<256}N=_([p(0,w.IBufferService)],N)},844:(y,r)=>{function l(_){for(let p of _)p.dispose();_.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let _ of this._disposables)_.dispose();this._disposables.length=0}register(_){return this._disposables.push(_),_}unregister(_){let p=this._disposables.indexOf(_);p!==-1&&this._disposables.splice(p,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(_){this._isDisposed||_===this._value||(this._value?.dispose(),this._value=_)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(_){return{dispose:_}},r.disposeArray=l,r.getDisposeArrayDisposable=function(_){return{dispose:()=>l(_)}}},114:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof process<"u"&&"title"in process;let l=r.isNode?"node":navigator.userAgent,_=r.isNode?"node":navigator.platform;r.isFirefox=l.includes("Firefox"),r.isLegacyEdge=l.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(l),r.getSafariVersion=function(){if(!r.isSafari)return 0;let p=l.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(_),r.isIpad=_==="iPad",r.isIphone=_==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(_),r.isLinux=_.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(l)},226:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;let _=l(114);class p{constructor(){this._tasks=[],this._i=0}enqueue(c){this._tasks.push(c),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(c){this._idleCallback=void 0;let u=0,m=0,t=c.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(u=Date.now(),this._tasks[this._i]()||this._i++,u=Math.max(1,Date.now()-u),m=Math.max(u,m),o=c.timeRemaining(),1.5*m>o)return t-u<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(t-u))}ms`),void this._start();t=o}this.clear()}}class s extends p{_requestCallback(c){return setTimeout(()=>c(this._createDeadline(16)))}_cancelCallback(c){clearTimeout(c)}_createDeadline(c){let u=Date.now()+c;return{timeRemaining:()=>Math.max(0,u-Date.now())}}}r.PriorityTaskQueue=s,r.IdleTaskQueue=!_.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:s,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},282:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;let _=l(643);r.updateWindowsModeWrappedState=function(p){let s=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),f=s?.get(p.cols-1),c=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);c&&f&&(c.isWrapped=f[_.CHAR_DATA_CODE_INDEX]!==_.NULL_CELL_CODE&&f[_.CHAR_DATA_CODE_INDEX]!==_.WHITESPACE_CELL_CODE)}},734:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class l{constructor(){this.fg=0,this.bg=0,this.extended=new _}static toColorRGB(s){return[s>>>16&255,s>>>8&255,255&s]}static fromColorRGB(s){return(255&s[0])<<16|(255&s[1])<<8|255&s[2]}clone(){let s=new l;return s.fg=this.fg,s.bg=this.bg,s.extended=this.extended.clone(),s}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}r.AttributeData=l;class _{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(s){this._ext=s}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(s){this._ext&=-469762049,this._ext|=s<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(s){this._ext&=-67108864,this._ext|=67108863&s}get urlId(){return this._urlId}set urlId(s){this._urlId=s}get underlineVariantOffset(){let s=(3758096384&this._ext)>>29;return s<0?4294967288^s:s}set underlineVariantOffset(s){this._ext&=536870911,this._ext|=s<<29&3758096384}constructor(s=0,f=0){this._ext=0,this._urlId=0,this._ext=s,this._urlId=f}clone(){return new _(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=_},92:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;let _=l(349),p=l(226),s=l(734),f=l(437),c=l(634),u=l(511),m=l(643),t=l(863),o=l(116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(h,a,v){this._hasScrollback=h,this._optionsService=a,this._bufferService=v,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=o.DEFAULT_CHARSET,this.markers=[],this._nullCell=u.CellData.fromCharData([0,m.NULL_CELL_CHAR,m.NULL_CELL_WIDTH,m.NULL_CELL_CODE]),this._whitespaceCell=u.CellData.fromCharData([0,m.WHITESPACE_CELL_CHAR,m.WHITESPACE_CELL_WIDTH,m.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new p.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new _.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(h){return h?(this._nullCell.fg=h.fg,this._nullCell.bg=h.bg,this._nullCell.extended=h.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new s.ExtendedAttrs),this._nullCell}getWhitespaceCell(h){return h?(this._whitespaceCell.fg=h.fg,this._whitespaceCell.bg=h.bg,this._whitespaceCell.extended=h.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new s.ExtendedAttrs),this._whitespaceCell}getBlankLine(h,a){return new f.BufferLine(this._bufferService.cols,this.getNullCell(h),a)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let h=this.ybase+this.y-this.ydisp;return h>=0&&h<this._rows}_getCorrectBufferLength(h){if(!this._hasScrollback)return h;let a=h+this._optionsService.rawOptions.scrollback;return a>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:a}fillViewportRows(h){if(this.lines.length===0){h===void 0&&(h=f.DEFAULT_ATTR_DATA);let a=this._rows;for(;a--;)this.lines.push(this.getBlankLine(h))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new _.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(h,a){let v=this.getNullCell(f.DEFAULT_ATTR_DATA),w=0,T=this._getCorrectBufferLength(a);if(T>this.lines.maxLength&&(this.lines.maxLength=T),this.lines.length>0){if(this._cols<h)for(let k=0;k<this.lines.length;k++)w+=+this.lines.get(k).resize(h,v);let L=0;if(this._rows<a)for(let k=this._rows;k<a;k++)this.lines.length<a+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(h,v)):this.ybase>0&&this.lines.length<=this.ybase+this.y+L+1?(this.ybase--,L++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(h,v)));else for(let k=this._rows;k>a;k--)this.lines.length>a+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(T<this.lines.maxLength){let k=this.lines.length-T;k>0&&(this.lines.trimStart(k),this.ybase=Math.max(this.ybase-k,0),this.ydisp=Math.max(this.ydisp-k,0),this.savedY=Math.max(this.savedY-k,0)),this.lines.maxLength=T}this.x=Math.min(this.x,h-1),this.y=Math.min(this.y,a-1),L&&(this.y+=L),this.savedX=Math.min(this.savedX,h-1),this.scrollTop=0}if(this.scrollBottom=a-1,this._isReflowEnabled&&(this._reflow(h,a),this._cols>h))for(let L=0;L<this.lines.length;L++)w+=+this.lines.get(L).resize(h,v);this._cols=h,this._rows=a,this._memoryCleanupQueue.clear(),w>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let h=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,h=!1);let a=0;for(;this._memoryCleanupPosition<this.lines.length;)if(a+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),a>100)return!0;return h}get _isReflowEnabled(){let h=this._optionsService.rawOptions.windowsPty;return h&&h.buildNumber?this._hasScrollback&&h.backend==="conpty"&&h.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(h,a){this._cols!==h&&(h>this._cols?this._reflowLarger(h,a):this._reflowSmaller(h,a))}_reflowLarger(h,a){let v=(0,c.reflowLargerGetLinesToRemove)(this.lines,this._cols,h,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(v.length>0){let w=(0,c.reflowLargerCreateNewLayout)(this.lines,v);(0,c.reflowLargerApplyNewLayout)(this.lines,w.layout),this._reflowLargerAdjustViewport(h,a,w.countRemoved)}}_reflowLargerAdjustViewport(h,a,v){let w=this.getNullCell(f.DEFAULT_ATTR_DATA),T=v;for(;T-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<a&&this.lines.push(new f.BufferLine(h,w))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-v,0)}_reflowSmaller(h,a){let v=this.getNullCell(f.DEFAULT_ATTR_DATA),w=[],T=0;for(let L=this.lines.length-1;L>=0;L--){let k=this.lines.get(L);if(!k||!k.isWrapped&&k.getTrimmedLength()<=h)continue;let R=[k];for(;k.isWrapped&&L>0;)k=this.lines.get(--L),R.unshift(k);let q=this.ybase+this.y;if(q>=L&&q<L+R.length)continue;let M=R[R.length-1].getTrimmedLength(),B=(0,c.reflowSmallerGetNewLineLengths)(R,this._cols,h),D=B.length-R.length,se;se=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+D):Math.max(0,this.lines.length-this.lines.maxLength+D);let ee=[];for(let C=0;C<D;C++){let x=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);ee.push(x)}ee.length>0&&(w.push({start:L+R.length+T,newLines:ee}),T+=ee.length),R.push(...ee);let N=B.length-1,J=B[N];J===0&&(N--,J=B[N]);let I=R.length-D-1,g=M;for(;I>=0;){let C=Math.min(g,J);if(R[N]===void 0)break;if(R[N].copyCellsFrom(R[I],g-C,J-C,C,!0),J-=C,J===0&&(N--,J=B[N]),g-=C,g===0){I--;let x=Math.max(I,0);g=(0,c.getWrappedLineTrimmedLength)(R,x,this._cols)}}for(let C=0;C<R.length;C++)B[C]<h&&R[C].setCell(B[C],v);let A=D-se;for(;A-- >0;)this.ybase===0?this.y<a-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+T)-a&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+D,this.ybase+a-1)}if(w.length>0){let L=[],k=[];for(let N=0;N<this.lines.length;N++)k.push(this.lines.get(N));let R=this.lines.length,q=R-1,M=0,B=w[M];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+T);let D=0;for(let N=Math.min(this.lines.maxLength-1,R+T-1);N>=0;N--)if(B&&B.start>q+D){for(let J=B.newLines.length-1;J>=0;J--)this.lines.set(N--,B.newLines[J]);N++,L.push({index:q+1,amount:B.newLines.length}),D+=B.newLines.length,B=w[++M]}else this.lines.set(N,k[q--]);let se=0;for(let N=L.length-1;N>=0;N--)L[N].index+=se,this.lines.onInsertEmitter.fire(L[N]),se+=L[N].amount;let ee=Math.max(0,R+T-this.lines.maxLength);ee>0&&this.lines.onTrimEmitter.fire(ee)}}translateBufferLineToString(h,a,v=0,w){let T=this.lines.get(h);return T?T.translateToString(a,v,w):""}getWrappedRangeForLine(h){let a=h,v=h;for(;a>0&&this.lines.get(a).isWrapped;)a--;for(;v+1<this.lines.length&&this.lines.get(v+1).isWrapped;)v++;return{first:a,last:v}}setupTabStops(h){for(h!=null?this.tabs[h]||(h=this.prevStop(h)):(this.tabs={},h=0);h<this._cols;h+=this._optionsService.rawOptions.tabStopWidth)this.tabs[h]=!0}prevStop(h){for(h==null&&(h=this.x);!this.tabs[--h]&&h>0;);return h>=this._cols?this._cols-1:h<0?0:h}nextStop(h){for(h==null&&(h=this.x);!this.tabs[++h]&&h<this._cols;);return h>=this._cols?this._cols-1:h<0?0:h}clearMarkers(h){this._isClearing=!0;for(let a=0;a<this.markers.length;a++)this.markers[a].line===h&&(this.markers[a].dispose(),this.markers.splice(a--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let h=0;h<this.markers.length;h++)this.markers[h].dispose(),this.markers.splice(h--,1);this._isClearing=!1}addMarker(h){let a=new t.Marker(h);return this.markers.push(a),a.register(this.lines.onTrim(v=>{a.line-=v,a.line<0&&a.dispose()})),a.register(this.lines.onInsert(v=>{a.line>=v.index&&(a.line+=v.amount)})),a.register(this.lines.onDelete(v=>{a.line>=v.index&&a.line<v.index+v.amount&&a.dispose(),a.line>v.index&&(a.line-=v.amount)})),a.register(a.onDispose(()=>this._removeMarker(a))),a}_removeMarker(h){this._isClearing||this.markers.splice(this.markers.indexOf(h),1)}}},437:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;let _=l(734),p=l(511),s=l(643),f=l(482);r.DEFAULT_ATTR_DATA=Object.freeze(new _.AttributeData);let c=0;class u{constructor(t,o,h=!1){this.isWrapped=h,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*t);let a=o||p.CellData.fromCharData([0,s.NULL_CELL_CHAR,s.NULL_CELL_WIDTH,s.NULL_CELL_CODE]);for(let v=0;v<t;++v)this.setCell(v,a);this.length=t}get(t){let o=this._data[3*t+0],h=2097151&o;return[this._data[3*t+1],2097152&o?this._combined[t]:h?(0,f.stringFromCodePoint)(h):"",o>>22,2097152&o?this._combined[t].charCodeAt(this._combined[t].length-1):h]}set(t,o){this._data[3*t+1]=o[s.CHAR_DATA_ATTR_INDEX],o[s.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[t]=o[1],this._data[3*t+0]=2097152|t|o[s.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*t+0]=o[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|o[s.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(t){return this._data[3*t+0]>>22}hasWidth(t){return 12582912&this._data[3*t+0]}getFg(t){return this._data[3*t+1]}getBg(t){return this._data[3*t+2]}hasContent(t){return 4194303&this._data[3*t+0]}getCodePoint(t){let o=this._data[3*t+0];return 2097152&o?this._combined[t].charCodeAt(this._combined[t].length-1):2097151&o}isCombined(t){return 2097152&this._data[3*t+0]}getString(t){let o=this._data[3*t+0];return 2097152&o?this._combined[t]:2097151&o?(0,f.stringFromCodePoint)(2097151&o):""}isProtected(t){return 536870912&this._data[3*t+2]}loadCell(t,o){return c=3*t,o.content=this._data[c+0],o.fg=this._data[c+1],o.bg=this._data[c+2],2097152&o.content&&(o.combinedData=this._combined[t]),268435456&o.bg&&(o.extended=this._extendedAttrs[t]),o}setCell(t,o){2097152&o.content&&(this._combined[t]=o.combinedData),268435456&o.bg&&(this._extendedAttrs[t]=o.extended),this._data[3*t+0]=o.content,this._data[3*t+1]=o.fg,this._data[3*t+2]=o.bg}setCellFromCodepoint(t,o,h,a){268435456&a.bg&&(this._extendedAttrs[t]=a.extended),this._data[3*t+0]=o|h<<22,this._data[3*t+1]=a.fg,this._data[3*t+2]=a.bg}addCodepointToCell(t,o,h){let a=this._data[3*t+0];2097152&a?this._combined[t]+=(0,f.stringFromCodePoint)(o):2097151&a?(this._combined[t]=(0,f.stringFromCodePoint)(2097151&a)+(0,f.stringFromCodePoint)(o),a&=-2097152,a|=2097152):a=o|4194304,h&&(a&=-12582913,a|=h<<22),this._data[3*t+0]=a}insertCells(t,o,h){if((t%=this.length)&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,h),o<this.length-t){let a=new p.CellData;for(let v=this.length-t-o-1;v>=0;--v)this.setCell(t+o+v,this.loadCell(t+v,a));for(let v=0;v<o;++v)this.setCell(t+v,h)}else for(let a=t;a<this.length;++a)this.setCell(a,h);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,h)}deleteCells(t,o,h){if(t%=this.length,o<this.length-t){let a=new p.CellData;for(let v=0;v<this.length-t-o;++v)this.setCell(t+v,this.loadCell(t+o+v,a));for(let v=this.length-o;v<this.length;++v)this.setCell(v,h)}else for(let a=t;a<this.length;++a)this.setCell(a,h);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,h),this.getWidth(t)!==0||this.hasContent(t)||this.setCellFromCodepoint(t,0,1,h)}replaceCells(t,o,h,a=!1){if(a)for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,h),o<this.length&&this.getWidth(o-1)===2&&!this.isProtected(o)&&this.setCellFromCodepoint(o,0,1,h);t<o&&t<this.length;)this.isProtected(t)||this.setCell(t,h),t++;else for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,h),o<this.length&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o,0,1,h);t<o&&t<this.length;)this.setCell(t++,h)}resize(t,o){if(t===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let h=3*t;if(t>this.length){if(this._data.buffer.byteLength>=4*h)this._data=new Uint32Array(this._data.buffer,0,h);else{let a=new Uint32Array(h);a.set(this._data),this._data=a}for(let a=this.length;a<t;++a)this.setCell(a,o)}else{this._data=this._data.subarray(0,h);let a=Object.keys(this._combined);for(let w=0;w<a.length;w++){let T=parseInt(a[w],10);T>=t&&delete this._combined[T]}let v=Object.keys(this._extendedAttrs);for(let w=0;w<v.length;w++){let T=parseInt(v[w],10);T>=t&&delete this._extendedAttrs[T]}}return this.length=t,4*h*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,o=!1){if(o)for(let h=0;h<this.length;++h)this.isProtected(h)||this.setCell(h,t);else{this._combined={},this._extendedAttrs={};for(let h=0;h<this.length;++h)this.setCell(h,t)}}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let o in t._combined)this._combined[o]=t._combined[o];this._extendedAttrs={};for(let o in t._extendedAttrs)this._extendedAttrs[o]=t._extendedAttrs[o];this.isWrapped=t.isWrapped}clone(){let t=new u(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let o in this._combined)t._combined[o]=this._combined[o];for(let o in this._extendedAttrs)t._extendedAttrs[o]=this._extendedAttrs[o];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0])return t+(this._data[3*t+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0]||50331648&this._data[3*t+2])return t+(this._data[3*t+0]>>22);return 0}copyCellsFrom(t,o,h,a,v){let w=t._data;if(v)for(let L=a-1;L>=0;L--){for(let k=0;k<3;k++)this._data[3*(h+L)+k]=w[3*(o+L)+k];268435456&w[3*(o+L)+2]&&(this._extendedAttrs[h+L]=t._extendedAttrs[o+L])}else for(let L=0;L<a;L++){for(let k=0;k<3;k++)this._data[3*(h+L)+k]=w[3*(o+L)+k];268435456&w[3*(o+L)+2]&&(this._extendedAttrs[h+L]=t._extendedAttrs[o+L])}let T=Object.keys(t._combined);for(let L=0;L<T.length;L++){let k=parseInt(T[L],10);k>=o&&(this._combined[k-o+h]=t._combined[k])}}translateToString(t,o,h,a){o=o??0,h=h??this.length,t&&(h=Math.min(h,this.getTrimmedLength())),a&&(a.length=0);let v="";for(;o<h;){let w=this._data[3*o+0],T=2097151&w,L=2097152&w?this._combined[o]:T?(0,f.stringFromCodePoint)(T):s.WHITESPACE_CELL_CHAR;if(v+=L,a)for(let k=0;k<L.length;++k)a.push(o);o+=w>>22||1}return a&&a.push(o),v}}r.BufferLine=u},634:(y,r)=>{function l(_,p,s){if(p===_.length-1)return _[p].getTrimmedLength();let f=!_[p].hasContent(s-1)&&_[p].getWidth(s-1)===1,c=_[p+1].getWidth(0)===2;return f&&c?s-1:s}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(_,p,s,f,c){let u=[];for(let m=0;m<_.length-1;m++){let t=m,o=_.get(++t);if(!o.isWrapped)continue;let h=[_.get(m)];for(;t<_.length&&o.isWrapped;)h.push(o),o=_.get(++t);if(f>=m&&f<t){m+=h.length-1;continue}let a=0,v=l(h,a,p),w=1,T=0;for(;w<h.length;){let k=l(h,w,p),R=k-T,q=s-v,M=Math.min(R,q);h[a].copyCellsFrom(h[w],T,v,M,!1),v+=M,v===s&&(a++,v=0),T+=M,T===k&&(w++,T=0),v===0&&a!==0&&h[a-1].getWidth(s-1)===2&&(h[a].copyCellsFrom(h[a-1],s-1,v++,1,!1),h[a-1].setCell(s-1,c))}h[a].replaceCells(v,s,c);let L=0;for(let k=h.length-1;k>0&&(k>a||h[k].getTrimmedLength()===0);k--)L++;L>0&&(u.push(m+h.length-L),u.push(L)),m+=h.length-1}return u},r.reflowLargerCreateNewLayout=function(_,p){let s=[],f=0,c=p[f],u=0;for(let m=0;m<_.length;m++)if(c===m){let t=p[++f];_.onDeleteEmitter.fire({index:m-u,amount:t}),m+=t-1,u+=t,c=p[++f]}else s.push(m);return{layout:s,countRemoved:u}},r.reflowLargerApplyNewLayout=function(_,p){let s=[];for(let f=0;f<p.length;f++)s.push(_.get(p[f]));for(let f=0;f<s.length;f++)_.set(f,s[f]);_.length=p.length},r.reflowSmallerGetNewLineLengths=function(_,p,s){let f=[],c=_.map((o,h)=>l(_,h,p)).reduce((o,h)=>o+h),u=0,m=0,t=0;for(;t<c;){if(c-t<s){f.push(c-t);break}u+=s;let o=l(_,m,p);u>o&&(u-=o,m++);let h=_[m].getWidth(u-1)===2;h&&u--;let a=h?s-1:s;f.push(a),t+=a}return f},r.getWrappedLineTrimmedLength=l},295:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;let _=l(460),p=l(844),s=l(92);class f extends p.Disposable{constructor(u,m){super(),this._optionsService=u,this._bufferService=m,this._onBufferActivate=this.register(new _.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new s.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new s.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(u){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(u),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(u,m){this._normal.resize(u,m),this._alt.resize(u,m),this.setupTabStops(u)}setupTabStops(u){this._normal.setupTabStops(u),this._alt.setupTabStops(u)}}r.BufferSet=f},511:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;let _=l(482),p=l(643),s=l(734);class f extends s.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new s.ExtendedAttrs,this.combinedData=""}static fromCharData(u){let m=new f;return m.setFromCharData(u),m}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,_.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(u){this.fg=u[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let m=!1;if(u[p.CHAR_DATA_CHAR_INDEX].length>2)m=!0;else if(u[p.CHAR_DATA_CHAR_INDEX].length===2){let t=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=t&&t<=56319){let o=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=o&&o<=57343?this.content=1024*(t-55296)+o-56320+65536|u[p.CHAR_DATA_WIDTH_INDEX]<<22:m=!0}else m=!0}else this.content=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|u[p.CHAR_DATA_WIDTH_INDEX]<<22;m&&(this.combinedData=u[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|u[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=f},643:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},863:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;let _=l(460),p=l(844);class s{get id(){return this._id}constructor(c){this.line=c,this.isDisposed=!1,this._disposables=[],this._id=s._nextId++,this._onDispose=this.register(new _.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(c){return this._disposables.push(c),c}}r.Marker=s,s._nextId=1},116:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},r.CHARSETS.A={"#":"\xA3"},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},r.CHARSETS.C=r.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},r.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},r.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},r.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},r.CHARSETS.E=r.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},r.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},r.CHARSETS.H=r.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},584:(y,r)=>{var l,_,p;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,function(s){s.NUL="\0",s.SOH="",s.STX="",s.ETX="",s.EOT="",s.ENQ="",s.ACK="",s.BEL="\x07",s.BS="\b",s.HT="	",s.LF=`
`,s.VT="\v",s.FF="\f",s.CR="\r",s.SO="",s.SI="",s.DLE="",s.DC1="",s.DC2="",s.DC3="",s.DC4="",s.NAK="",s.SYN="",s.ETB="",s.CAN="",s.EM="",s.SUB="",s.ESC="\x1B",s.FS="",s.GS="",s.RS="",s.US="",s.SP=" ",s.DEL="\x7F"}(l||(r.C0=l={})),function(s){s.PAD="\x80",s.HOP="\x81",s.BPH="\x82",s.NBH="\x83",s.IND="\x84",s.NEL="\x85",s.SSA="\x86",s.ESA="\x87",s.HTS="\x88",s.HTJ="\x89",s.VTS="\x8A",s.PLD="\x8B",s.PLU="\x8C",s.RI="\x8D",s.SS2="\x8E",s.SS3="\x8F",s.DCS="\x90",s.PU1="\x91",s.PU2="\x92",s.STS="\x93",s.CCH="\x94",s.MW="\x95",s.SPA="\x96",s.EPA="\x97",s.SOS="\x98",s.SGCI="\x99",s.SCI="\x9A",s.CSI="\x9B",s.ST="\x9C",s.OSC="\x9D",s.PM="\x9E",s.APC="\x9F"}(_||(r.C1=_={})),function(s){s.ST=`${l.ESC}\\`}(p||(r.C1_ESCAPED=p={}))},482:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(l){return l>65535?(l-=65536,String.fromCharCode(55296+(l>>10))+String.fromCharCode(l%1024+56320)):String.fromCharCode(l)},r.utf32ToString=function(l,_=0,p=l.length){let s="";for(let f=_;f<p;++f){let c=l[f];c>65535?(c-=65536,s+=String.fromCharCode(55296+(c>>10))+String.fromCharCode(c%1024+56320)):s+=String.fromCharCode(c)}return s},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(l,_){let p=l.length;if(!p)return 0;let s=0,f=0;if(this._interim){let c=l.charCodeAt(f++);56320<=c&&c<=57343?_[s++]=1024*(this._interim-55296)+c-56320+65536:(_[s++]=this._interim,_[s++]=c),this._interim=0}for(let c=f;c<p;++c){let u=l.charCodeAt(c);if(55296<=u&&u<=56319){if(++c>=p)return this._interim=u,s;let m=l.charCodeAt(c);56320<=m&&m<=57343?_[s++]=1024*(u-55296)+m-56320+65536:(_[s++]=u,_[s++]=m)}else u!==65279&&(_[s++]=u)}return s}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(l,_){let p=l.length;if(!p)return 0;let s,f,c,u,m=0,t=0,o=0;if(this.interim[0]){let v=!1,w=this.interim[0];w&=(224&w)==192?31:(240&w)==224?15:7;let T,L=0;for(;(T=63&this.interim[++L])&&L<4;)w<<=6,w|=T;let k=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,R=k-L;for(;o<R;){if(o>=p)return 0;if(T=l[o++],(192&T)!=128){o--,v=!0;break}this.interim[L++]=T,w<<=6,w|=63&T}v||(k===2?w<128?o--:_[m++]=w:k===3?w<2048||w>=55296&&w<=57343||w===65279||(_[m++]=w):w<65536||w>1114111||(_[m++]=w)),this.interim.fill(0)}let h=p-4,a=o;for(;a<p;){for(;!(!(a<h)||128&(s=l[a])||128&(f=l[a+1])||128&(c=l[a+2])||128&(u=l[a+3]));)_[m++]=s,_[m++]=f,_[m++]=c,_[m++]=u,a+=4;if(s=l[a++],s<128)_[m++]=s;else if((224&s)==192){if(a>=p)return this.interim[0]=s,m;if(f=l[a++],(192&f)!=128){a--;continue}if(t=(31&s)<<6|63&f,t<128){a--;continue}_[m++]=t}else if((240&s)==224){if(a>=p)return this.interim[0]=s,m;if(f=l[a++],(192&f)!=128){a--;continue}if(a>=p)return this.interim[0]=s,this.interim[1]=f,m;if(c=l[a++],(192&c)!=128){a--;continue}if(t=(15&s)<<12|(63&f)<<6|63&c,t<2048||t>=55296&&t<=57343||t===65279)continue;_[m++]=t}else if((248&s)==240){if(a>=p)return this.interim[0]=s,m;if(f=l[a++],(192&f)!=128){a--;continue}if(a>=p)return this.interim[0]=s,this.interim[1]=f,m;if(c=l[a++],(192&c)!=128){a--;continue}if(a>=p)return this.interim[0]=s,this.interim[1]=f,this.interim[2]=c,m;if(u=l[a++],(192&u)!=128){a--;continue}if(t=(7&s)<<18|(63&f)<<12|(63&c)<<6|63&u,t<65536||t>1114111)continue;_[m++]=t}}return m}}},225:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;let _=l(480),p=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],s=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],f;r.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let c=0;c<p.length;++c)f.fill(0,p[c][0],p[c][1]+1)}}wcwidth(c){return c<32?0:c<127?1:c<65536?f[c]:function(u,m){let t,o=0,h=m.length-1;if(u<m[0][0]||u>m[h][1])return!1;for(;h>=o;)if(t=o+h>>1,u>m[t][1])o=t+1;else{if(!(u<m[t][0]))return!0;h=t-1}return!1}(c,s)?0:c>=131072&&c<=196605||c>=196608&&c<=262141?2:1}charProperties(c,u){let m=this.wcwidth(c),t=m===0&&u!==0;if(t){let o=_.UnicodeService.extractWidth(u);o===0?t=!1:o>m&&(m=o)}return _.UnicodeService.createPropertyValue(0,m,t)}}},981:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;let _=l(460),p=l(844);class s extends p.Disposable{constructor(c){super(),this._action=c,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new _.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(c,u){if(u!==void 0&&this._syncCalls>u)return void(this._syncCalls=0);if(this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let m;for(this._isSyncWriting=!0;m=this._writeBuffer.shift();){this._action(m);let t=this._callbacks.shift();t&&t()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(c,u){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(u),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(u)}_innerWrite(c=0,u=!0){let m=c||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let t=this._writeBuffer[this._bufferOffset],o=this._action(t,u);if(o){let a=v=>Date.now()-m>=12?setTimeout(()=>this._innerWrite(0,v)):this._innerWrite(m,v);return void o.catch(v=>(queueMicrotask(()=>{throw v}),Promise.resolve(!1))).then(a)}let h=this._callbacks[this._bufferOffset];if(h&&h(),this._bufferOffset++,this._pendingData-=t.length,Date.now()-m>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=s},941:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;let l=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,_=/^[\da-f]+$/;function p(s,f){let c=s.toString(16),u=c.length<2?"0"+c:c;switch(f){case 4:return c[0];case 8:return u;case 12:return(u+u).slice(0,3);default:return u+u}}r.parseColor=function(s){if(!s)return;let f=s.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);let c=l.exec(f);if(c){let u=c[1]?15:c[4]?255:c[7]?4095:65535;return[Math.round(parseInt(c[1]||c[4]||c[7]||c[10],16)/u*255),Math.round(parseInt(c[2]||c[5]||c[8]||c[11],16)/u*255),Math.round(parseInt(c[3]||c[6]||c[9]||c[12],16)/u*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),_.exec(f)&&[3,6,9,12].includes(f.length))){let c=f.length/3,u=[0,0,0];for(let m=0;m<3;++m){let t=parseInt(f.slice(c*m,c*m+c),16);u[m]=c===1?t<<4:c===2?t:c===3?t>>4:t>>8}return u}},r.toRgbString=function(s,f=16){let[c,u,m]=s;return`rgb:${p(c,f)}/${p(u,f)}/${p(m,f)}`}},770:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},351:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;let _=l(482),p=l(742),s=l(770),f=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(u,m){this._handlers[u]===void 0&&(this._handlers[u]=[]);let t=this._handlers[u];return t.push(m),{dispose:()=>{let o=t.indexOf(m);o!==-1&&t.splice(o,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}reset(){if(this._active.length)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(u,m){if(this.reset(),this._ident=u,this._active=this._handlers[u]||f,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].hook(m);else this._handlerFb(this._ident,"HOOK",m)}put(u,m,t){if(this._active.length)for(let o=this._active.length-1;o>=0;o--)this._active[o].put(u,m,t);else this._handlerFb(this._ident,"PUT",(0,_.utf32ToString)(u,m,t))}unhook(u,m=!0){if(this._active.length){let t=!1,o=this._active.length-1,h=!1;if(this._stack.paused&&(o=this._stack.loopPosition-1,t=m,h=this._stack.fallThrough,this._stack.paused=!1),!h&&t===!1){for(;o>=0&&(t=this._active[o].unhook(u),t!==!0);o--)if(t instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!1,t;o--}for(;o>=0;o--)if(t=this._active[o].unhook(!1),t instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!0,t}else this._handlerFb(this._ident,"UNHOOK",u);this._active=f,this._ident=0}};let c=new p.Params;c.addParam(0),r.DcsHandler=class{constructor(u){this._handler=u,this._data="",this._params=c,this._hitLimit=!1}hook(u){this._params=u.length>1||u.params[0]?u.clone():c,this._data="",this._hitLimit=!1}put(u,m,t){this._hitLimit||(this._data+=(0,_.utf32ToString)(u,m,t),this._data.length>s.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(u){let m=!1;if(this._hitLimit)m=!1;else if(u&&(m=this._handler(this._data,this._params),m instanceof Promise))return m.then(t=>(this._params=c,this._data="",this._hitLimit=!1,t));return this._params=c,this._data="",this._hitLimit=!1,m}}},15:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;let _=l(844),p=l(742),s=l(242),f=l(351);class c{constructor(o){this.table=new Uint8Array(o)}setDefault(o,h){this.table.fill(o<<4|h)}add(o,h,a,v){this.table[h<<8|o]=a<<4|v}addMany(o,h,a,v){for(let w=0;w<o.length;w++)this.table[h<<8|o[w]]=a<<4|v}}r.TransitionTable=c;let u=160;r.VT500_TRANSITION_TABLE=function(){let t=new c(4095),o=Array.apply(null,Array(256)).map((L,k)=>k),h=(L,k)=>o.slice(L,k),a=h(32,127),v=h(0,24);v.push(25),v.push.apply(v,h(28,32));let w=h(0,14),T;for(T in t.setDefault(1,0),t.addMany(a,0,2,0),w)t.addMany([24,26,153,154],T,3,0),t.addMany(h(128,144),T,3,0),t.addMany(h(144,152),T,3,0),t.add(156,T,0,0),t.add(27,T,11,1),t.add(157,T,4,8),t.addMany([152,158,159],T,0,7),t.add(155,T,11,3),t.add(144,T,11,9);return t.addMany(v,0,3,0),t.addMany(v,1,3,1),t.add(127,1,0,1),t.addMany(v,8,0,8),t.addMany(v,3,3,3),t.add(127,3,0,3),t.addMany(v,4,3,4),t.add(127,4,0,4),t.addMany(v,6,3,6),t.addMany(v,5,3,5),t.add(127,5,0,5),t.addMany(v,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(a,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(h(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(a,7,0,7),t.addMany(v,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(h(64,127),3,7,0),t.addMany(h(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(h(48,60),4,8,4),t.addMany(h(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(h(32,64),6,0,6),t.add(127,6,0,6),t.addMany(h(64,127),6,0,0),t.addMany(h(32,48),3,9,5),t.addMany(h(32,48),5,9,5),t.addMany(h(48,64),5,0,6),t.addMany(h(64,127),5,7,0),t.addMany(h(32,48),4,9,5),t.addMany(h(32,48),1,9,2),t.addMany(h(32,48),2,9,2),t.addMany(h(48,127),2,10,0),t.addMany(h(48,80),1,10,0),t.addMany(h(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(h(96,127),1,10,0),t.add(80,1,11,9),t.addMany(v,9,0,9),t.add(127,9,0,9),t.addMany(h(28,32),9,0,9),t.addMany(h(32,48),9,9,12),t.addMany(h(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(v,11,0,11),t.addMany(h(32,128),11,0,11),t.addMany(h(28,32),11,0,11),t.addMany(v,10,0,10),t.add(127,10,0,10),t.addMany(h(28,32),10,0,10),t.addMany(h(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(h(32,48),10,9,12),t.addMany(v,12,0,12),t.add(127,12,0,12),t.addMany(h(28,32),12,0,12),t.addMany(h(32,48),12,9,12),t.addMany(h(48,64),12,0,11),t.addMany(h(64,127),12,12,13),t.addMany(h(64,127),10,12,13),t.addMany(h(64,127),9,12,13),t.addMany(v,13,13,13),t.addMany(a,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(u,0,2,0),t.add(u,8,5,8),t.add(u,6,0,6),t.add(u,11,0,11),t.add(u,13,13,13),t}();class m extends _.Disposable{constructor(o=r.VT500_TRANSITION_TABLE){super(),this._transitions=o,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(h,a,v)=>{},this._executeHandlerFb=h=>{},this._csiHandlerFb=(h,a)=>{},this._escHandlerFb=h=>{},this._errorHandlerFb=h=>h,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,_.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new s.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(o,h=[64,126]){let a=0;if(o.prefix){if(o.prefix.length>1)throw new Error("only one byte as prefix supported");if(a=o.prefix.charCodeAt(0),a&&60>a||a>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(o.intermediates){if(o.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let w=0;w<o.intermediates.length;++w){let T=o.intermediates.charCodeAt(w);if(32>T||T>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");a<<=8,a|=T}}if(o.final.length!==1)throw new Error("final must be a single byte");let v=o.final.charCodeAt(0);if(h[0]>v||v>h[1])throw new Error(`final must be in range ${h[0]} .. ${h[1]}`);return a<<=8,a|=v,a}identToString(o){let h=[];for(;o;)h.push(String.fromCharCode(255&o)),o>>=8;return h.reverse().join("")}setPrintHandler(o){this._printHandler=o}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(o,h){let a=this._identifier(o,[48,126]);this._escHandlers[a]===void 0&&(this._escHandlers[a]=[]);let v=this._escHandlers[a];return v.push(h),{dispose:()=>{let w=v.indexOf(h);w!==-1&&v.splice(w,1)}}}clearEscHandler(o){this._escHandlers[this._identifier(o,[48,126])]&&delete this._escHandlers[this._identifier(o,[48,126])]}setEscHandlerFallback(o){this._escHandlerFb=o}setExecuteHandler(o,h){this._executeHandlers[o.charCodeAt(0)]=h}clearExecuteHandler(o){this._executeHandlers[o.charCodeAt(0)]&&delete this._executeHandlers[o.charCodeAt(0)]}setExecuteHandlerFallback(o){this._executeHandlerFb=o}registerCsiHandler(o,h){let a=this._identifier(o);this._csiHandlers[a]===void 0&&(this._csiHandlers[a]=[]);let v=this._csiHandlers[a];return v.push(h),{dispose:()=>{let w=v.indexOf(h);w!==-1&&v.splice(w,1)}}}clearCsiHandler(o){this._csiHandlers[this._identifier(o)]&&delete this._csiHandlers[this._identifier(o)]}setCsiHandlerFallback(o){this._csiHandlerFb=o}registerDcsHandler(o,h){return this._dcsParser.registerHandler(this._identifier(o),h)}clearDcsHandler(o){this._dcsParser.clearHandler(this._identifier(o))}setDcsHandlerFallback(o){this._dcsParser.setHandlerFallback(o)}registerOscHandler(o,h){return this._oscParser.registerHandler(o,h)}clearOscHandler(o){this._oscParser.clearHandler(o)}setOscHandlerFallback(o){this._oscParser.setHandlerFallback(o)}setErrorHandler(o){this._errorHandler=o}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(o,h,a,v,w){this._parseStack.state=o,this._parseStack.handlers=h,this._parseStack.handlerPos=a,this._parseStack.transition=v,this._parseStack.chunkPos=w}parse(o,h,a){let v,w=0,T=0,L=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,L=this._parseStack.chunkPos+1;else{if(a===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let k=this._parseStack.handlers,R=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(a===!1&&R>-1){for(;R>=0&&(v=k[R](this._params),v!==!0);R--)if(v instanceof Promise)return this._parseStack.handlerPos=R,v}this._parseStack.handlers=[];break;case 4:if(a===!1&&R>-1){for(;R>=0&&(v=k[R](),v!==!0);R--)if(v instanceof Promise)return this._parseStack.handlerPos=R,v}this._parseStack.handlers=[];break;case 6:if(w=o[this._parseStack.chunkPos],v=this._dcsParser.unhook(w!==24&&w!==26,a),v)return v;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(w=o[this._parseStack.chunkPos],v=this._oscParser.end(w!==24&&w!==26,a),v)return v;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,L=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let k=L;k<h;++k){switch(w=o[k],T=this._transitions.table[this.currentState<<8|(w<160?w:u)],T>>4){case 2:for(let D=k+1;;++D){if(D>=h||(w=o[D])<32||w>126&&w<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=h||(w=o[D])<32||w>126&&w<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=h||(w=o[D])<32||w>126&&w<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=h||(w=o[D])<32||w>126&&w<u){this._printHandler(o,k,D),k=D-1;break}}break;case 3:this._executeHandlers[w]?this._executeHandlers[w]():this._executeHandlerFb(w),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:k,code:w,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let R=this._csiHandlers[this._collect<<8|w],q=R?R.length-1:-1;for(;q>=0&&(v=R[q](this._params),v!==!0);q--)if(v instanceof Promise)return this._preserveStack(3,R,q,T,k),v;q<0&&this._csiHandlerFb(this._collect<<8|w,this._params),this.precedingJoinState=0;break;case 8:do switch(w){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(w-48)}while(++k<h&&(w=o[k])>47&&w<60);k--;break;case 9:this._collect<<=8,this._collect|=w;break;case 10:let M=this._escHandlers[this._collect<<8|w],B=M?M.length-1:-1;for(;B>=0&&(v=M[B](),v!==!0);B--)if(v instanceof Promise)return this._preserveStack(4,M,B,T,k),v;B<0&&this._escHandlerFb(this._collect<<8|w),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|w,this._params);break;case 13:for(let D=k+1;;++D)if(D>=h||(w=o[D])===24||w===26||w===27||w>127&&w<u){this._dcsParser.put(o,k,D),k=D-1;break}break;case 14:if(v=this._dcsParser.unhook(w!==24&&w!==26),v)return this._preserveStack(6,[],0,T,k),v;w===27&&(T|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let D=k+1;;D++)if(D>=h||(w=o[D])<32||w>127&&w<u){this._oscParser.put(o,k,D),k=D-1;break}break;case 6:if(v=this._oscParser.end(w!==24&&w!==26),v)return this._preserveStack(5,[],0,T,k),v;w===27&&(T|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&T}}}r.EscapeSequenceParser=m},242:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;let _=l(770),p=l(482),s=[];r.OscParser=class{constructor(){this._state=0,this._active=s,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,c){this._handlers[f]===void 0&&(this._handlers[f]=[]);let u=this._handlers[f];return u.push(c),{dispose:()=>{let m=u.indexOf(c);m!==-1&&u.splice(m,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=s}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=s,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||s,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,c,u){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(f,c,u);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(f,c,u))}start(){this.reset(),this._state=1}put(f,c,u){if(this._state!==3){if(this._state===1)for(;c<u;){let m=f[c++];if(m===59){this._state=2,this._start();break}if(m<48||57<m)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+m-48}this._state===2&&u-c>0&&this._put(f,c,u)}}end(f,c=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let u=!1,m=this._active.length-1,t=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,u=c,t=this._stack.fallThrough,this._stack.paused=!1),!t&&u===!1){for(;m>=0&&(u=this._active[m].end(f),u!==!0);m--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,u;m--}for(;m>=0;m--)if(u=this._active[m].end(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,u}else this._handlerFb(this._id,"END",f);this._active=s,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,c,u){this._hitLimit||(this._data+=(0,p.utf32ToString)(f,c,u),this._data.length>_.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let c=!1;if(this._hitLimit)c=!1;else if(f&&(c=this._handler(this._data),c instanceof Promise))return c.then(u=>(this._data="",this._hitLimit=!1,u));return this._data="",this._hitLimit=!1,c}}},742:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;let l=2147483647;class _{static fromArray(s){let f=new _;if(!s.length)return f;for(let c=Array.isArray(s[0])?1:0;c<s.length;++c){let u=s[c];if(Array.isArray(u))for(let m=0;m<u.length;++m)f.addSubParam(u[m]);else f.addParam(u)}return f}constructor(s=32,f=32){if(this.maxLength=s,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(s),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(s),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let s=new _(this.maxLength,this.maxSubParamsLength);return s.params.set(this.params),s.length=this.length,s._subParams.set(this._subParams),s._subParamsLength=this._subParamsLength,s._subParamsIdx.set(this._subParamsIdx),s._rejectDigits=this._rejectDigits,s._rejectSubDigits=this._rejectSubDigits,s._digitIsSub=this._digitIsSub,s}toArray(){let s=[];for(let f=0;f<this.length;++f){s.push(this.params[f]);let c=this._subParamsIdx[f]>>8,u=255&this._subParamsIdx[f];u-c>0&&s.push(Array.prototype.slice.call(this._subParams,c,u))}return s}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(s){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(s<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=s>l?l:s}}addSubParam(s){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(s<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=s>l?l:s,this._subParamsIdx[this.length-1]++}}hasSubParams(s){return(255&this._subParamsIdx[s])-(this._subParamsIdx[s]>>8)>0}getSubParams(s){let f=this._subParamsIdx[s]>>8,c=255&this._subParamsIdx[s];return c-f>0?this._subParams.subarray(f,c):null}getSubParamsAll(){let s={};for(let f=0;f<this.length;++f){let c=this._subParamsIdx[f]>>8,u=255&this._subParamsIdx[f];u-c>0&&(s[f]=this._subParams.slice(c,u))}return s}addDigit(s){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let c=this._digitIsSub?this._subParams:this.params,u=c[f-1];c[f-1]=~u?Math.min(10*u+s,l):s}}r.Params=_},741:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let l=this._addons.length-1;l>=0;l--)this._addons[l].instance.dispose()}loadAddon(l,_){let p={instance:_,dispose:_.dispose,isDisposed:!1};this._addons.push(p),_.dispose=()=>this._wrappedAddonDispose(p),_.activate(l)}_wrappedAddonDispose(l){if(l.isDisposed)return;let _=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===l){_=p;break}if(_===-1)throw new Error("Could not dispose an addon that has not been loaded");l.isDisposed=!0,l.dispose.apply(l.instance),this._addons.splice(_,1)}}},771:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;let _=l(785),p=l(511);r.BufferApiView=class{constructor(s,f){this._buffer=s,this.type=f}init(s){return this._buffer=s,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(s){let f=this._buffer.lines.get(s);if(f)return new _.BufferLineApiView(f)}getNullCell(){return new p.CellData}}},785:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;let _=l(511);r.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,s){if(!(p<0||p>=this._line.length))return s?(this._line.loadCell(p,s),s):this._line.loadCell(p,new _.CellData)}translateToString(p,s,f){return this._line.translateToString(p,s,f)}}},285:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;let _=l(771),p=l(460),s=l(844);class f extends s.Disposable{constructor(u){super(),this._core=u,this._onBufferChange=this.register(new p.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new _.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new _.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=f},975:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(l){this._core=l}registerCsiHandler(l,_){return this._core.registerCsiHandler(l,p=>_(p.toArray()))}addCsiHandler(l,_){return this.registerCsiHandler(l,_)}registerDcsHandler(l,_){return this._core.registerDcsHandler(l,(p,s)=>_(p,s.toArray()))}addDcsHandler(l,_){return this.registerDcsHandler(l,_)}registerEscHandler(l,_){return this._core.registerEscHandler(l,_)}addEscHandler(l,_){return this.registerEscHandler(l,_)}registerOscHandler(l,_){return this._core.registerOscHandler(l,_)}addOscHandler(l,_){return this.registerOscHandler(l,_)}}},90:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(l){this._core=l}register(l){this._core.unicodeService.register(l)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(l){this._core.unicodeService.activeVersion=l}}},744:function(y,r,l){var _=this&&this.__decorate||function(t,o,h,a){var v,w=arguments.length,T=w<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,h):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(t,o,h,a);else for(var L=t.length-1;L>=0;L--)(v=t[L])&&(T=(w<3?v(T):w>3?v(o,h,T):v(o,h))||T);return w>3&&T&&Object.defineProperty(o,h,T),T},p=this&&this.__param||function(t,o){return function(h,a){o(h,a,t)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;let s=l(460),f=l(844),c=l(295),u=l(585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let m=r.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(t){super(),this.isUserScrolling=!1,this._onResize=this.register(new s.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(t.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(t.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new c.BufferSet(t,this))}resize(t,o){this.cols=t,this.rows=o,this.buffers.resize(t,o),this._onResize.fire({cols:t,rows:o})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(t,o=!1){let h=this.buffer,a;a=this._cachedBlankLine,a&&a.length===this.cols&&a.getFg(0)===t.fg&&a.getBg(0)===t.bg||(a=h.getBlankLine(t,o),this._cachedBlankLine=a),a.isWrapped=o;let v=h.ybase+h.scrollTop,w=h.ybase+h.scrollBottom;if(h.scrollTop===0){let T=h.lines.isFull;w===h.lines.length-1?T?h.lines.recycle().copyFrom(a):h.lines.push(a.clone()):h.lines.splice(w+1,0,a.clone()),T?this.isUserScrolling&&(h.ydisp=Math.max(h.ydisp-1,0)):(h.ybase++,this.isUserScrolling||h.ydisp++)}else{let T=w-v+1;h.lines.shiftElements(v+1,T-1,-1),h.lines.set(w,a.clone())}this.isUserScrolling||(h.ydisp=h.ybase),this._onScroll.fire(h.ydisp)}scrollLines(t,o,h){let a=this.buffer;if(t<0){if(a.ydisp===0)return;this.isUserScrolling=!0}else t+a.ydisp>=a.ybase&&(this.isUserScrolling=!1);let v=a.ydisp;a.ydisp=Math.max(Math.min(a.ydisp+t,a.ybase),0),v!==a.ydisp&&(o||this._onScroll.fire(a.ydisp))}};r.BufferService=m=_([p(0,u.IOptionsService)],m)},994:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(l){this.glevel=l,this.charset=this._charsets[l]}setgCharset(l,_){this._charsets[l]=_,this.glevel===l&&(this.charset=_)}}},753:function(y,r,l){var _=this&&this.__decorate||function(a,v,w,T){var L,k=arguments.length,R=k<3?v:T===null?T=Object.getOwnPropertyDescriptor(v,w):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(a,v,w,T);else for(var q=a.length-1;q>=0;q--)(L=a[q])&&(R=(k<3?L(R):k>3?L(v,w,R):L(v,w))||R);return k>3&&R&&Object.defineProperty(v,w,R),R},p=this&&this.__param||function(a,v){return function(w,T){v(w,T,a)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;let s=l(585),f=l(460),c=l(844),u={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:a=>a.button!==4&&a.action===1&&(a.ctrl=!1,a.alt=!1,a.shift=!1,!0)},VT200:{events:19,restrict:a=>a.action!==32},DRAG:{events:23,restrict:a=>a.action!==32||a.button!==3},ANY:{events:31,restrict:a=>!0}};function m(a,v){let w=(a.ctrl?16:0)|(a.shift?4:0)|(a.alt?8:0);return a.button===4?(w|=64,w|=a.action):(w|=3&a.button,4&a.button&&(w|=64),8&a.button&&(w|=128),a.action===32?w|=32:a.action!==0||v||(w|=3)),w}let t=String.fromCharCode,o={DEFAULT:a=>{let v=[m(a,!1)+32,a.col+32,a.row+32];return v[0]>255||v[1]>255||v[2]>255?"":`\x1B[M${t(v[0])}${t(v[1])}${t(v[2])}`},SGR:a=>{let v=a.action===0&&a.button!==4?"m":"M";return`\x1B[<${m(a,!0)};${a.col};${a.row}${v}`},SGR_PIXELS:a=>{let v=a.action===0&&a.button!==4?"m":"M";return`\x1B[<${m(a,!0)};${a.x};${a.y}${v}`}},h=r.CoreMouseService=class extends c.Disposable{constructor(a,v){super(),this._bufferService=a,this._coreService=v,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let w of Object.keys(u))this.addProtocol(w,u[w]);for(let w of Object.keys(o))this.addEncoding(w,o[w]);this.reset()}addProtocol(a,v){this._protocols[a]=v}addEncoding(a,v){this._encodings[a]=v}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(a){if(!this._protocols[a])throw new Error(`unknown protocol "${a}"`);this._activeProtocol=a,this._onProtocolChange.fire(this._protocols[a].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(a){if(!this._encodings[a])throw new Error(`unknown encoding "${a}"`);this._activeEncoding=a}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(a){if(a.col<0||a.col>=this._bufferService.cols||a.row<0||a.row>=this._bufferService.rows||a.button===4&&a.action===32||a.button===3&&a.action!==32||a.button!==4&&(a.action===2||a.action===3)||(a.col++,a.row++,a.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,a,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(a))return!1;let v=this._encodings[this._activeEncoding](a);return v&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(v):this._coreService.triggerDataEvent(v,!0)),this._lastEvent=a,!0}explainEvents(a){return{down:!!(1&a),up:!!(2&a),drag:!!(4&a),move:!!(8&a),wheel:!!(16&a)}}_equalEvents(a,v,w){if(w){if(a.x!==v.x||a.y!==v.y)return!1}else if(a.col!==v.col||a.row!==v.row)return!1;return a.button===v.button&&a.action===v.action&&a.ctrl===v.ctrl&&a.alt===v.alt&&a.shift===v.shift}};r.CoreMouseService=h=_([p(0,s.IBufferService),p(1,s.ICoreService)],h)},83:function(y,r,l){var _=this&&this.__decorate||function(h,a,v,w){var T,L=arguments.length,k=L<3?a:w===null?w=Object.getOwnPropertyDescriptor(a,v):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(h,a,v,w);else for(var R=h.length-1;R>=0;R--)(T=h[R])&&(k=(L<3?T(k):L>3?T(a,v,k):T(a,v))||k);return L>3&&k&&Object.defineProperty(a,v,k),k},p=this&&this.__param||function(h,a){return function(v,w){a(v,w,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;let s=l(439),f=l(460),c=l(844),u=l(585),m=Object.freeze({insertMode:!1}),t=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),o=r.CoreService=class extends c.Disposable{constructor(h,a,v){super(),this._bufferService=h,this._logService=a,this._optionsService=v,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,s.clone)(m),this.decPrivateModes=(0,s.clone)(t)}reset(){this.modes=(0,s.clone)(m),this.decPrivateModes=(0,s.clone)(t)}triggerDataEvent(h,a=!1){if(this._optionsService.rawOptions.disableStdin)return;let v=this._bufferService.buffer;a&&this._optionsService.rawOptions.scrollOnUserInput&&v.ybase!==v.ydisp&&this._onRequestScrollToBottom.fire(),a&&this._onUserInput.fire(),this._logService.debug(`sending data "${h}"`,()=>h.split("").map(w=>w.charCodeAt(0))),this._onData.fire(h)}triggerBinaryEvent(h){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${h}"`,()=>h.split("").map(a=>a.charCodeAt(0))),this._onBinary.fire(h))}};r.CoreService=o=_([p(0,u.IBufferService),p(1,u.ILogService),p(2,u.IOptionsService)],o)},348:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;let _=l(585),p=l(343);class s{constructor(...c){this._entries=new Map;for(let[u,m]of c)this.set(u,m)}set(c,u){let m=this._entries.get(c);return this._entries.set(c,u),m}forEach(c){for(let[u,m]of this._entries.entries())c(u,m)}has(c){return this._entries.has(c)}get(c){return this._entries.get(c)}}r.ServiceCollection=s,r.InstantiationService=class{constructor(){this._services=new s,this._services.set(_.IInstantiationService,this)}setService(f,c){this._services.set(f,c)}getService(f){return this._services.get(f)}createInstance(f,...c){let u=(0,p.getServiceDependencies)(f).sort((o,h)=>o.index-h.index),m=[];for(let o of u){let h=this._services.get(o.id);if(!h)throw new Error(`[createInstance] ${f.name} depends on UNKNOWN service ${o.id}.`);m.push(h)}let t=u.length>0?u[0].index:c.length;if(c.length!==t)throw new Error(`[createInstance] First service dependency of ${f.name} at position ${t+1} conflicts with ${c.length} static arguments`);return new f(...c,...m)}}},866:function(y,r,l){var _=this&&this.__decorate||function(t,o,h,a){var v,w=arguments.length,T=w<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,h):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(t,o,h,a);else for(var L=t.length-1;L>=0;L--)(v=t[L])&&(T=(w<3?v(T):w>3?v(o,h,T):v(o,h))||T);return w>3&&T&&Object.defineProperty(o,h,T),T},p=this&&this.__param||function(t,o){return function(h,a){o(h,a,t)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;let s=l(844),f=l(585),c={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF},u,m=r.LogService=class extends s.Disposable{get logLevel(){return this._logLevel}constructor(t){super(),this._optionsService=t,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),u=this}_updateLogLevel(){this._logLevel=c[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(t){for(let o=0;o<t.length;o++)typeof t[o]=="function"&&(t[o]=t[o]())}_log(t,o,h){this._evalLazyOptionalParams(h),t.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+o,...h)}trace(t,...o){this._logLevel<=f.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,t,o)}debug(t,...o){this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,t,o)}info(t,...o){this._logLevel<=f.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,t,o)}warn(t,...o){this._logLevel<=f.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,t,o)}error(t,...o){this._logLevel<=f.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,t,o)}};r.LogService=m=_([p(0,f.IOptionsService)],m),r.setTraceLogger=function(t){u=t},r.traceCall=function(t,o,h){if(typeof h.value!="function")throw new Error("not supported");let a=h.value;h.value=function(...v){if(u.logLevel!==f.LogLevelEnum.TRACE)return a.apply(this,v);u.trace(`GlyphRenderer#${a.name}(${v.map(T=>JSON.stringify(T)).join(", ")})`);let w=a.apply(this,v);return u.trace(`GlyphRenderer#${a.name} return`,w),w}}},302:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;let _=l(460),p=l(844),s=l(114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:s.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let f=["normal","bold","100","200","300","400","500","600","700","800","900"];class c extends p.Disposable{constructor(m){super(),this._onOptionChange=this.register(new _.EventEmitter),this.onOptionChange=this._onOptionChange.event;let t={...r.DEFAULT_OPTIONS};for(let o in m)if(o in t)try{let h=m[o];t[o]=this._sanitizeAndValidateOption(o,h)}catch(h){console.error(h)}this.rawOptions=t,this.options={...t},this._setupOptions(),this.register((0,p.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(m,t){return this.onOptionChange(o=>{o===m&&t(this.rawOptions[m])})}onMultipleOptionChange(m,t){return this.onOptionChange(o=>{m.indexOf(o)!==-1&&t()})}_setupOptions(){let m=o=>{if(!(o in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);return this.rawOptions[o]},t=(o,h)=>{if(!(o in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);h=this._sanitizeAndValidateOption(o,h),this.rawOptions[o]!==h&&(this.rawOptions[o]=h,this._onOptionChange.fire(o))};for(let o in this.rawOptions){let h={get:m.bind(this,o),set:t.bind(this,o)};Object.defineProperty(this.options,o,h)}}_sanitizeAndValidateOption(m,t){switch(m){case"cursorStyle":if(t||(t=r.DEFAULT_OPTIONS[m]),!function(o){return o==="block"||o==="underline"||o==="bar"}(t))throw new Error(`"${t}" is not a valid value for ${m}`);break;case"wordSeparator":t||(t=r.DEFAULT_OPTIONS[m]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=f.includes(t)?t:r.DEFAULT_OPTIONS[m];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${m} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(10*t)/10));break;case"scrollback":if((t=Math.min(t,4294967295))<0)throw new Error(`${m} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${m} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${m} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{}}return t}}r.OptionsService=c},660:function(y,r,l){var _=this&&this.__decorate||function(c,u,m,t){var o,h=arguments.length,a=h<3?u:t===null?t=Object.getOwnPropertyDescriptor(u,m):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(c,u,m,t);else for(var v=c.length-1;v>=0;v--)(o=c[v])&&(a=(h<3?o(a):h>3?o(u,m,a):o(u,m))||a);return h>3&&a&&Object.defineProperty(u,m,a),a},p=this&&this.__param||function(c,u){return function(m,t){u(m,t,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;let s=l(585),f=r.OscLinkService=class{constructor(c){this._bufferService=c,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(c){let u=this._bufferService.buffer;if(c.id===void 0){let v=u.addMarker(u.ybase+u.y),w={data:c,id:this._nextId++,lines:[v]};return v.onDispose(()=>this._removeMarkerFromLink(w,v)),this._dataByLinkId.set(w.id,w),w.id}let m=c,t=this._getEntryIdKey(m),o=this._entriesWithId.get(t);if(o)return this.addLineToLink(o.id,u.ybase+u.y),o.id;let h=u.addMarker(u.ybase+u.y),a={id:this._nextId++,key:this._getEntryIdKey(m),data:m,lines:[h]};return h.onDispose(()=>this._removeMarkerFromLink(a,h)),this._entriesWithId.set(a.key,a),this._dataByLinkId.set(a.id,a),a.id}addLineToLink(c,u){let m=this._dataByLinkId.get(c);if(m&&m.lines.every(t=>t.line!==u)){let t=this._bufferService.buffer.addMarker(u);m.lines.push(t),t.onDispose(()=>this._removeMarkerFromLink(m,t))}}getLinkData(c){return this._dataByLinkId.get(c)?.data}_getEntryIdKey(c){return`${c.id};;${c.uri}`}_removeMarkerFromLink(c,u){let m=c.lines.indexOf(u);m!==-1&&(c.lines.splice(m,1),c.lines.length===0&&(c.data.id!==void 0&&this._entriesWithId.delete(c.key),this._dataByLinkId.delete(c.id)))}};r.OscLinkService=f=_([p(0,s.IBufferService)],f)},343:(y,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;let l="di$target",_="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(p){return p[_]||[]},r.createDecorator=function(p){if(r.serviceRegistry.has(p))return r.serviceRegistry.get(p);let s=function(f,c,u){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(m,t,o){t[l]===t?t[_].push({id:m,index:o}):(t[_]=[{id:m,index:o}],t[l]=t)})(s,f,u)};return s.toString=()=>p,r.serviceRegistry.set(p,s),s}},585:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;let _=l(343);var p;r.IBufferService=(0,_.createDecorator)("BufferService"),r.ICoreMouseService=(0,_.createDecorator)("CoreMouseService"),r.ICoreService=(0,_.createDecorator)("CoreService"),r.ICharsetService=(0,_.createDecorator)("CharsetService"),r.IInstantiationService=(0,_.createDecorator)("InstantiationService"),function(s){s[s.TRACE=0]="TRACE",s[s.DEBUG=1]="DEBUG",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.OFF=5]="OFF"}(p||(r.LogLevelEnum=p={})),r.ILogService=(0,_.createDecorator)("LogService"),r.IOptionsService=(0,_.createDecorator)("OptionsService"),r.IOscLinkService=(0,_.createDecorator)("OscLinkService"),r.IUnicodeService=(0,_.createDecorator)("UnicodeService"),r.IDecorationService=(0,_.createDecorator)("DecorationService")},480:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;let _=l(460),p=l(225);class s{static extractShouldJoin(c){return(1&c)!=0}static extractWidth(c){return c>>1&3}static extractCharKind(c){return c>>3}static createPropertyValue(c,u,m=!1){return(16777215&c)<<3|(3&u)<<1|(m?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new _.EventEmitter,this.onChange=this._onChange.event;let c=new p.UnicodeV6;this.register(c),this._active=c.version,this._activeProvider=c}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(c){if(!this._providers[c])throw new Error(`unknown Unicode version "${c}"`);this._active=c,this._activeProvider=this._providers[c],this._onChange.fire(c)}register(c){this._providers[c.version]=c}wcwidth(c){return this._activeProvider.wcwidth(c)}getStringCellWidth(c){let u=0,m=0,t=c.length;for(let o=0;o<t;++o){let h=c.charCodeAt(o);if(55296<=h&&h<=56319){if(++o>=t)return u+this.wcwidth(h);let w=c.charCodeAt(o);56320<=w&&w<=57343?h=1024*(h-55296)+w-56320+65536:u+=this.wcwidth(w)}let a=this.charProperties(h,m),v=s.extractWidth(a);s.extractShouldJoin(a)&&(v-=s.extractWidth(m)),u+=v,m=a}return u}charProperties(c,u){return this._activeProvider.charProperties(c,u)}}r.UnicodeService=s},781:(y,r,l)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;let _=l(437),p=l(969),s=l(460);class f extends p.CoreTerminal{constructor(u={}){super(u),this._onBell=this.register(new s.EventEmitter),this.onBell=this._onBell.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onA11yCharEmitter=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yCharEmitter.event,this._onA11yTabEmitter=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTabEmitter.event,this._setup(),this.register(this._inputHandler.onRequestBell(()=>this.bell())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register((0,s.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,s.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,s.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,s.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter))}get buffer(){return this.buffers.active}get markers(){return this.buffer.markers}addMarker(u){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+u)}bell(){this._onBell.fire()}input(u,m=!0){this.coreService.triggerDataEvent(u,m)}resize(u,m){u===this.cols&&m===this.rows||super.resize(u,m)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let u=1;u<this.rows;u++)this.buffer.lines.push(this.buffer.getBlankLine(_.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){this.options.rows=this.rows,this.options.cols=this.cols,this._setup(),super.reset()}}r.Terminal=f}},i={};function e(y){var r=i[y];if(r!==void 0)return r.exports;var l=i[y]={exports:{}};return S[y].call(l.exports,l,l.exports,e),l.exports}var n={};(()=>{var y=n;Object.defineProperty(y,"__esModule",{value:!0}),y.Terminal=void 0;let r=e(285),l=e(975),_=e(90),p=e(781),s=e(741),f=e(844),c=["cols","rows"];class u extends f.Disposable{constructor(t){super(),this._core=this.register(new p.Terminal(t)),this._addonManager=this.register(new s.AddonManager),this._publicOptions={...this._core.options};let o=a=>this._core.options[a],h=(a,v)=>{this._checkReadonlyOptions(a),this._core.options[a]=v};for(let a in this._core.options){Object.defineProperty(this._publicOptions,a,{get:()=>this._core.options[a],set:w=>{this._checkReadonlyOptions(a),this._core.options[a]=w}});let v={get:o.bind(this,a),set:h.bind(this,a)};Object.defineProperty(this._publicOptions,a,v)}}_checkReadonlyOptions(t){if(c.includes(t))throw new Error(`Option "${t}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.options.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onLineFeed(){return this._core.onLineFeed}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onTitleChange(){return this._core.onTitleChange}get parser(){return this._checkProposedApi(),this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._checkProposedApi(),this._buffer||(this._buffer=this.register(new r.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let t=this._core.coreService.decPrivateModes,o="none";switch(this._core.coreMouseService.activeProtocol){case"X10":o="x10";break;case"VT200":o="vt200";break;case"DRAG":o="drag";break;case"ANY":o="any"}return{applicationCursorKeysMode:t.applicationCursorKeys,applicationKeypadMode:t.applicationKeypad,bracketedPasteMode:t.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:o,originMode:t.origin,reverseWraparoundMode:t.reverseWraparound,sendFocusMode:t.sendFocus,wraparoundMode:t.wraparound}}get options(){return this._publicOptions}set options(t){for(let o in t)this._publicOptions[o]=t[o]}input(t,o=!0){this._core.input(t,o)}resize(t,o){this._verifyIntegers(t,o),this._core.resize(t,o)}registerMarker(t=0){return this._checkProposedApi(),this._verifyIntegers(t),this._core.addMarker(t)}addMarker(t){return this.registerMarker(t)}dispose(){super.dispose()}scrollLines(t){this._verifyIntegers(t),this._core.scrollLines(t)}scrollPages(t){this._verifyIntegers(t),this._core.scrollPages(t)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(t){this._verifyIntegers(t),this._core.scrollToLine(t)}clear(){this._core.clear()}write(t,o){this._core.write(t,o)}writeln(t,o){this._core.write(t),this._core.write(`\r
`,o)}reset(){this._core.reset()}loadAddon(t){this._addonManager.loadAddon(this,t)}_verifyIntegers(...t){for(let o of t)if(o===1/0||isNaN(o)||o%1!=0)throw new Error("This API only accepts integers")}}y.Terminal=u})();var d=qt;for(var b in n)d[b]=n[b];n.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})()});var ie,rt,it,Yt=at(()=>{({subtle:ie}=globalThis.crypto),rt=class rt{constructor(i){this.keys=new Map;this.storageKey=i||rt.DEFAULT_STORAGE_KEY,this.loadKeysFromStorage()}isUnlocked(){return!0}async addKey(i,e){try{let n=await this.parsePrivateKey(e),d=this.generateKeyId(),b={id:d,name:i,publicKey:n.publicKey,privateKey:e,algorithm:"Ed25519",encrypted:n.encrypted,fingerprint:n.fingerprint,createdAt:new Date().toISOString()};return this.keys.set(d,b),this.saveKeysToStorage(),d}catch(n){throw new Error(`Failed to add SSH key: ${n}`)}}removeKey(i){this.keys.delete(i),this.saveKeysToStorage()}listKeys(){return Array.from(this.keys.values()).map(i=>({id:i.id,name:i.name,publicKey:i.publicKey,algorithm:i.algorithm,encrypted:i.encrypted,fingerprint:i.fingerprint,createdAt:i.createdAt}))}async sign(i,e){let n=this.keys.get(i);if(!n)throw new Error("SSH key not found");if(!n.privateKey)throw new Error("Private key not available for signing");try{let d=n.privateKey;if(n.encrypted){let l=await this.promptForPassword(n.name);if(!l)throw new Error("Password required for encrypted key");d=await this.decryptPrivateKey(n.privateKey,l)}let b=await this.importPrivateKey(d,n.algorithm),y=this.base64ToArrayBuffer(e),r=await ie.sign({name:"Ed25519"},b,y);return{signature:this.arrayBufferToBase64(r),algorithm:n.algorithm}}catch(d){throw new Error(`Failed to sign data: ${d}`)}}async generateKeyPair(i,e){console.log(`\u{1F511} SSH Agent: Starting Ed25519 key generation for "${i}"`);try{let d=await ie.generateKey({name:"Ed25519"},!0,["sign","verify"]),b=await ie.exportKey("pkcs8",d.privateKey),y=await ie.exportKey("raw",d.publicKey),r=this.arrayBufferToPEM(b,"PRIVATE KEY"),l=this.convertEd25519ToSSHPublicKey(y),_=!!e;e&&(r=await this.encryptPrivateKey(r,e));let p=this.generateKeyId(),s={id:p,name:i,publicKey:l,privateKey:r,algorithm:"Ed25519",encrypted:_,fingerprint:await this.generateFingerprint(l),createdAt:new Date().toISOString()};return this.keys.set(p,s),await this.saveKeysToStorage(),console.log(`\u{1F511} SSH Agent: Key "${i}" generated successfully with ID: ${p}`),{keyId:p,privateKeyPEM:r}}catch(n){throw new Error(`Failed to generate key pair: ${n}`)}}getPublicKey(i){let e=this.keys.get(i);return e?e.publicKey:null}getPrivateKey(i){let e=this.keys.get(i);return e?e.privateKey:null}async parsePrivateKey(i){let e=i.includes("BEGIN ENCRYPTED PRIVATE KEY")||i.includes("Proc-Type: 4,ENCRYPTED");if(i.includes("BEGIN PRIVATE KEY")||i.includes("BEGIN ENCRYPTED PRIVATE KEY")){let n="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIImported...";return{publicKey:n,algorithm:"Ed25519",fingerprint:await this.generateFingerprint(n),encrypted:e}}throw new Error("Only Ed25519 private keys are supported")}async importPrivateKey(i,e){let n=i.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\s/g,""),d=this.base64ToArrayBuffer(n);return ie.importKey("pkcs8",d,{name:"Ed25519"},!1,["sign"])}convertEd25519ToSSHPublicKey(i){let e=new Uint8Array(i),d=new TextEncoder().encode("ssh-ed25519"),b=new ArrayBuffer(4+d.length+4+e.length),y=new DataView(b),r=new Uint8Array(b),l=0;return y.setUint32(l,d.length,!1),l+=4,r.set(d,l),l+=d.length,y.setUint32(l,e.length,!1),l+=4,r.set(e,l),`ssh-ed25519 ${this.arrayBufferToBase64(b)}`}async generateFingerprint(i){let e=new TextEncoder,n=await ie.digest("SHA-256",e.encode(i));return this.arrayBufferToBase64(n).substring(0,16)}generateKeyId(){return window.crypto.randomUUID()}arrayBufferToBase64(i){let e=new Uint8Array(i),n="";for(let d=0;d<e.length;d++)n+=String.fromCharCode(e[d]);return btoa(n)}base64ToArrayBuffer(i){let e=atob(i),n=new Uint8Array(e.length);for(let d=0;d<e.length;d++)n[d]=e.charCodeAt(d);return n.buffer}arrayBufferToPEM(i,e){let d=this.arrayBufferToBase64(i).match(/.{1,64}/g)||[];return`-----BEGIN ${e}-----
${d.join(`
`)}
-----END ${e}-----`}async loadKeysFromStorage(){try{let i=localStorage.getItem(this.storageKey);if(i){let e=JSON.parse(i);this.keys.clear(),e.forEach(n=>this.keys.set(n.id,n))}}catch(i){console.error("Failed to load SSH keys from storage:",i)}}async saveKeysToStorage(){try{let i=Array.from(this.keys.values());localStorage.setItem(this.storageKey,JSON.stringify(i))}catch(i){console.error("Failed to save SSH keys to storage:",i)}}async encryptPrivateKey(i,e){let n=new TextEncoder,d=n.encode(i),b=await ie.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveKey"]),y=crypto.getRandomValues(new Uint8Array(16)),r=await ie.deriveKey({name:"PBKDF2",salt:y,iterations:1e5,hash:"SHA-256"},b,{name:"AES-GCM",length:256},!1,["encrypt"]),l=crypto.getRandomValues(new Uint8Array(12)),_=await ie.encrypt({name:"AES-GCM",iv:l},r,d),p=new Uint8Array(y.length+l.length+_.byteLength);return p.set(y,0),p.set(l,y.length),p.set(new Uint8Array(_),y.length+l.length),`-----BEGIN ENCRYPTED PRIVATE KEY-----
${this.arrayBufferToBase64(p.buffer)}
-----END ENCRYPTED PRIVATE KEY-----`}async decryptPrivateKey(i,e){let n=i.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\s/g,""),d=this.base64ToArrayBuffer(n),b=new Uint8Array(d),y=b.slice(0,16),r=b.slice(16,28),l=b.slice(28),_=new TextEncoder,p=await ie.importKey("raw",_.encode(e),{name:"PBKDF2"},!1,["deriveKey"]),s=await ie.deriveKey({name:"PBKDF2",salt:y,iterations:1e5,hash:"SHA-256"},p,{name:"AES-GCM",length:256},!1,["decrypt"]),f=await ie.decrypt({name:"AES-GCM",iv:r},s,l);return new TextDecoder().decode(f)}async promptForPassword(i){return window.prompt(`Enter password for SSH key "${i}":`)}};rt.DEFAULT_STORAGE_KEY="vibetunnel_ssh_keys";it=rt});var Xt={};hi(Xt,{AuthClient:()=>st,authClient:()=>ki});var X,ne,st,ki,Gt=at(()=>{He();Yt();X=ce("auth-client"),ne=class ne{constructor(){this.currentUser=null;this.sshAgent=new it,this.loadCurrentUser()}getSSHAgent(){return this.sshAgent}isAuthenticated(){return this.currentUser!==null&&this.isTokenValid()}getCurrentUser(){return this.currentUser}async getCurrentSystemUser(){try{let i=await fetch("/api/auth/current-user");if(i.ok)return(await i.json()).userId;throw new Error("Failed to get current user")}catch(i){throw X.error("Failed to get current system user:",i),i}}async getUserAvatar(i){try{let e=await fetch(`/api/auth/avatar/${i}`);if(e.ok){let n=await e.json();if(n.avatar&&n.avatar.startsWith("data:"))return n.avatar}}catch(e){X.error("Failed to get user avatar:",e)}return"data:image/svg+xml;base64,"+btoa(`
      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="24" fill="#6B7280"/>
        <circle cx="24" cy="18" r="8" fill="#9CA3AF"/>
        <path d="M8 38c0-8.837 7.163-16 16-16s16 7.163 16 16" fill="#9CA3AF"/>
      </svg>
    `)}async authenticateWithSSHKey(i,e){try{if(!this.sshAgent.isUnlocked())return{success:!1,error:"SSH agent is locked"};let n=await this.createChallenge(i),d=await this.sshAgent.sign(e,n.challenge),b=this.sshAgent.getPublicKey(e);if(!b)return{success:!1,error:"SSH key not found"};let r=await(await fetch("/api/auth/ssh-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challengeId:n.challengeId,publicKey:b,signature:d.signature})})).json();return X.log("\u{1F510} SSH key auth server response:",r),r.success?(X.log("\u2705 SSH key auth successful, setting current user"),this.setCurrentUser({userId:r.userId,token:r.token,authMethod:"ssh-key",loginTime:Date.now()}),X.log("\u{1F464} Current user set:",this.getCurrentUser())):X.log("\u274C SSH key auth failed:",r.error),r}catch(n){return X.error("SSH key authentication failed:",n),{success:!1,error:"SSH key authentication failed"}}}async authenticateWithPassword(i,e){try{let d=await(await fetch("/api/auth/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:i,password:e})})).json();return d.success&&this.setCurrentUser({userId:d.userId,token:d.token,authMethod:"password",loginTime:Date.now()}),d}catch(n){return X.error("Password authentication failed:",n),{success:!1,error:"Password authentication failed"}}}async authenticate(i){if(X.log("\u{1F680} Starting SSH authentication for user:",i),this.sshAgent.isUnlocked()){let e=this.sshAgent.listKeys();X.log("\u{1F5DD}\uFE0F Found SSH keys:",e.length,e.map(n=>({id:n.id,name:n.name})));for(let n of e)try{X.log(`\u{1F511} Trying SSH key: ${n.name} (${n.id})`);let d=await this.authenticateWithSSHKey(i,n.id);if(X.log(`\u{1F3AF} SSH key ${n.name} result:`,d),d.success)return X.log(`\u2705 Authenticated with SSH key: ${n.name}`),d}catch(d){X.warn(`\u274C SSH key authentication failed for key ${n.name}:`,d)}}else X.log("\u{1F512} SSH agent is locked");return{success:!1,error:"SSH key authentication failed. Password authentication required."}}async logout(){try{this.currentUser?.token&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${this.currentUser.token}`,"Content-Type":"application/json"}})}catch(i){X.warn("Server logout failed:",i)}finally{this.clearCurrentUser()}}getAuthHeader(){return this.currentUser?.token?{Authorization:`Bearer ${this.currentUser.token}`}:{}}async verifyToken(){if(!this.currentUser?.token)return!1;try{return(await(await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${this.currentUser.token}`}})).json()).valid}catch(i){return X.error("Token verification failed:",i),!1}}async unlockSSHAgent(i){return!0}lockSSHAgent(){}isSSHAgentUnlocked(){return!0}async createChallenge(i){let e=await fetch("/api/auth/challenge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:i})});if(!e.ok)throw new Error("Failed to create authentication challenge");return e.json()}setCurrentUser(i){this.currentUser=i,this.saveCurrentUser()}clearCurrentUser(){this.currentUser=null,localStorage.removeItem(ne.TOKEN_KEY),localStorage.removeItem(ne.USER_KEY)}saveCurrentUser(){this.currentUser&&(localStorage.setItem(ne.TOKEN_KEY,this.currentUser.token),localStorage.setItem(ne.USER_KEY,JSON.stringify({userId:this.currentUser.userId,authMethod:this.currentUser.authMethod,loginTime:this.currentUser.loginTime})))}loadCurrentUser(){try{let i=localStorage.getItem(ne.TOKEN_KEY),e=localStorage.getItem(ne.USER_KEY);if(i&&e){let n=JSON.parse(e);this.currentUser={token:i,userId:n.userId,authMethod:n.authMethod,loginTime:n.loginTime},this.verifyToken().then(d=>{d||this.clearCurrentUser()})}}catch(i){X.error("Failed to load current user:",i),this.clearCurrentUser()}}isTokenValid(){if(!this.currentUser)return!1;let i=Date.now()-this.currentUser.loginTime,e=24*60*60*1e3;return i<e}};ne.TOKEN_KEY="vibetunnel_auth_token",ne.USER_KEY="vibetunnel_user_data";st=ne,ki=new st});async function Mi(){let S=Date.now();if(Oe&&S-Oe.timestamp<Bi)return Oe.noAuth;try{let i=await fetch("/api/auth/config");if(i.ok)return Oe={noAuth:(await i.json()).noAuth===!0,timestamp:S},Oe.noAuth}catch{}return!1}function Pi(S){return S.map(i=>{if(typeof i=="object"&&i!==null)try{return JSON.stringify(i,null,2)}catch{return String(i)}return i})}async function Ri(S,i,e){try{let{authClient:n}=await Promise.resolve().then(()=>(Gt(),Xt)),d=n.getAuthHeader(),b=await Mi();if(!d.Authorization&&!b)return;let y={"Content-Type":"application/json"};d.Authorization&&(y.Authorization=d.Authorization),await fetch("/api/logs/client",{method:"POST",headers:y,body:JSON.stringify({level:S,module:i,args:Pi(e)})})}catch{}}function ce(S){let i=e=>(...n)=>{e==="debug"&&!Li||(console[e](`[${S}]`,...n),Ri(e,S,n))};return{log:i("log"),warn:i("warn"),error:i("error"),debug:i("debug")}}var Li,Oe,Bi,He=at(()=>{Li=!1,Oe=null,Bi=6e4});var Ne=globalThis,We=Ne.ShadowRoot&&(Ne.ShadyCSS===void 0||Ne.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Et=Symbol(),Ct=new WeakMap,Fe=class{constructor(i,e,n){if(this._$cssResult$=!0,n!==Et)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=i,this.t=e}get styleSheet(){let i=this.o,e=this.t;if(We&&i===void 0){let n=e!==void 0&&e.length===1;n&&(i=Ct.get(e)),i===void 0&&((this.o=i=new CSSStyleSheet).replaceSync(this.cssText),n&&Ct.set(e,i))}return i}toString(){return this.cssText}},At=S=>new Fe(typeof S=="string"?S:S+"",void 0,Et);var xt=(S,i)=>{if(We)S.adoptedStyleSheets=i.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let e of i){let n=document.createElement("style"),d=Ne.litNonce;d!==void 0&&n.setAttribute("nonce",d),n.textContent=e.cssText,S.appendChild(n)}},ht=We?S=>S:S=>S instanceof CSSStyleSheet?(i=>{let e="";for(let n of i.cssRules)e+=n.cssText;return At(e)})(S):S;var{is:di,defineProperty:ui,getOwnPropertyDescriptor:fi,getOwnPropertyNames:pi,getOwnPropertySymbols:_i,getPrototypeOf:gi}=Object,he=globalThis,Tt=he.trustedTypes,mi=Tt?Tt.emptyScript:"",vi=he.reactiveElementPolyfillSupport,xe=(S,i)=>S,Te={toAttribute(S,i){switch(i){case Boolean:S=S?mi:null;break;case Object:case Array:S=S==null?S:JSON.stringify(S)}return S},fromAttribute(S,i){let e=S;switch(i){case Boolean:e=S!==null;break;case Number:e=S===null?null:Number(S);break;case Object:case Array:try{e=JSON.parse(S)}catch{e=null}}return e}},ze=(S,i)=>!di(S,i),kt={attribute:!0,type:String,converter:Te,reflect:!1,useDefault:!1,hasChanged:ze};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),he.litPropertyMetadata??(he.litPropertyMetadata=new WeakMap);var oe=class extends HTMLElement{static addInitializer(i){this._$Ei(),(this.l??(this.l=[])).push(i)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(i,e=kt){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(i)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(i,e),!e.noAccessor){let n=Symbol(),d=this.getPropertyDescriptor(i,n,e);d!==void 0&&ui(this.prototype,i,d)}}static getPropertyDescriptor(i,e,n){let{get:d,set:b}=fi(this.prototype,i)??{get(){return this[e]},set(y){this[e]=y}};return{get:d,set(y){let r=d?.call(this);b?.call(this,y),this.requestUpdate(i,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(i){return this.elementProperties.get(i)??kt}static _$Ei(){if(this.hasOwnProperty(xe("elementProperties")))return;let i=gi(this);i.finalize(),i.l!==void 0&&(this.l=[...i.l]),this.elementProperties=new Map(i.elementProperties)}static finalize(){if(this.hasOwnProperty(xe("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(xe("properties"))){let e=this.properties,n=[...pi(e),..._i(e)];for(let d of n)this.createProperty(d,e[d])}let i=this[Symbol.metadata];if(i!==null){let e=litPropertyMetadata.get(i);if(e!==void 0)for(let[n,d]of e)this.elementProperties.set(n,d)}this._$Eh=new Map;for(let[e,n]of this.elementProperties){let d=this._$Eu(e,n);d!==void 0&&this._$Eh.set(d,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(i){let e=[];if(Array.isArray(i)){let n=new Set(i.flat(1/0).reverse());for(let d of n)e.unshift(ht(d))}else i!==void 0&&e.push(ht(i));return e}static _$Eu(i,e){let n=e.attribute;return n===!1?void 0:typeof n=="string"?n:typeof i=="string"?i.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(i=>this.enableUpdating=i),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(i=>i(this))}addController(i){(this._$EO??(this._$EO=new Set)).add(i),this.renderRoot!==void 0&&this.isConnected&&i.hostConnected?.()}removeController(i){this._$EO?.delete(i)}_$E_(){let i=new Map,e=this.constructor.elementProperties;for(let n of e.keys())this.hasOwnProperty(n)&&(i.set(n,this[n]),delete this[n]);i.size>0&&(this._$Ep=i)}createRenderRoot(){let i=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return xt(i,this.constructor.elementStyles),i}connectedCallback(){this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),this._$EO?.forEach(i=>i.hostConnected?.())}enableUpdating(i){}disconnectedCallback(){this._$EO?.forEach(i=>i.hostDisconnected?.())}attributeChangedCallback(i,e,n){this._$AK(i,n)}_$ET(i,e){let n=this.constructor.elementProperties.get(i),d=this.constructor._$Eu(i,n);if(d!==void 0&&n.reflect===!0){let b=(n.converter?.toAttribute!==void 0?n.converter:Te).toAttribute(e,n.type);this._$Em=i,b==null?this.removeAttribute(d):this.setAttribute(d,b),this._$Em=null}}_$AK(i,e){let n=this.constructor,d=n._$Eh.get(i);if(d!==void 0&&this._$Em!==d){let b=n.getPropertyOptions(d),y=typeof b.converter=="function"?{fromAttribute:b.converter}:b.converter?.fromAttribute!==void 0?b.converter:Te;this._$Em=d,this[d]=y.fromAttribute(e,b.type)??this._$Ej?.get(d)??null,this._$Em=null}}requestUpdate(i,e,n){if(i!==void 0){let d=this.constructor,b=this[i];if(n??(n=d.getPropertyOptions(i)),!((n.hasChanged??ze)(b,e)||n.useDefault&&n.reflect&&b===this._$Ej?.get(i)&&!this.hasAttribute(d._$Eu(i,n))))return;this.C(i,e,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(i,e,{useDefault:n,reflect:d,wrapped:b},y){n&&!(this._$Ej??(this._$Ej=new Map)).has(i)&&(this._$Ej.set(i,y??e??this[i]),b!==!0||y!==void 0)||(this._$AL.has(i)||(this.hasUpdated||n||(e=void 0),this._$AL.set(i,e)),d===!0&&this._$Em!==i&&(this._$Eq??(this._$Eq=new Set)).add(i))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let i=this.scheduleUpdate();return i!=null&&await i,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[d,b]of this._$Ep)this[d]=b;this._$Ep=void 0}let n=this.constructor.elementProperties;if(n.size>0)for(let[d,b]of n){let{wrapped:y}=b,r=this[d];y!==!0||this._$AL.has(d)||r===void 0||this.C(d,void 0,b,r)}}let i=!1,e=this._$AL;try{i=this.shouldUpdate(e),i?(this.willUpdate(e),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(e)):this._$EM()}catch(n){throw i=!1,this._$EM(),n}i&&this._$AE(e)}willUpdate(i){}_$AE(i){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(i)),this.updated(i)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(i){return!0}update(i){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(i){}firstUpdated(i){}};oe.elementStyles=[],oe.shadowRootOptions={mode:"open"},oe[xe("elementProperties")]=new Map,oe[xe("finalized")]=new Map,vi?.({ReactiveElement:oe}),(he.reactiveElementVersions??(he.reactiveElementVersions=[])).push("2.1.0");var Le=globalThis,qe=Le.trustedTypes,Lt=qe?qe.createPolicy("lit-html",{createHTML:S=>S}):void 0,ct="$lit$",ae=`lit$${Math.random().toFixed(9).slice(2)}$`,dt="?"+ae,bi=`<${dt}>`,_e=document,Be=()=>_e.createComment(""),Me=S=>S===null||typeof S!="object"&&typeof S!="function",ut=Array.isArray,Ht=S=>ut(S)||typeof S?.[Symbol.iterator]=="function",lt=`[ 	
\f\r]`,ke=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Bt=/-->/g,Mt=/>/g,fe=RegExp(`>|${lt}(?:([^\\s"'>=/]+)(${lt}*=${lt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Pt=/'/g,Rt=/"/g,Ot=/^(?:script|style|textarea|title)$/i,ft=S=>(i,...e)=>({_$litType$:S,strings:i,values:e}),Q=ft(1),Vi=ft(2),Yi=ft(3),ge=Symbol.for("lit-noChange"),V=Symbol.for("lit-nothing"),Dt=new WeakMap,pe=_e.createTreeWalker(_e,129);function $t(S,i){if(!ut(S)||!S.hasOwnProperty("raw"))throw Error("invalid template strings array");return Lt!==void 0?Lt.createHTML(i):i}var It=(S,i)=>{let e=S.length-1,n=[],d,b=i===2?"<svg>":i===3?"<math>":"",y=ke;for(let r=0;r<e;r++){let l=S[r],_,p,s=-1,f=0;for(;f<l.length&&(y.lastIndex=f,p=y.exec(l),p!==null);)f=y.lastIndex,y===ke?p[1]==="!--"?y=Bt:p[1]!==void 0?y=Mt:p[2]!==void 0?(Ot.test(p[2])&&(d=RegExp("</"+p[2],"g")),y=fe):p[3]!==void 0&&(y=fe):y===fe?p[0]===">"?(y=d??ke,s=-1):p[1]===void 0?s=-2:(s=y.lastIndex-p[2].length,_=p[1],y=p[3]===void 0?fe:p[3]==='"'?Rt:Pt):y===Rt||y===Pt?y=fe:y===Bt||y===Mt?y=ke:(y=fe,d=void 0);let c=y===fe&&S[r+1].startsWith("/>")?" ":"";b+=y===ke?l+bi:s>=0?(n.push(_),l.slice(0,s)+ct+l.slice(s)+ae+c):l+ae+(s===-2?r:c)}return[$t(S,b+(S[e]||"<?>")+(i===2?"</svg>":i===3?"</math>":"")),n]},Pe=class S{constructor({strings:i,_$litType$:e},n){let d;this.parts=[];let b=0,y=0,r=i.length-1,l=this.parts,[_,p]=It(i,e);if(this.el=S.createElement(_,n),pe.currentNode=this.el.content,e===2||e===3){let s=this.el.content.firstChild;s.replaceWith(...s.childNodes)}for(;(d=pe.nextNode())!==null&&l.length<r;){if(d.nodeType===1){if(d.hasAttributes())for(let s of d.getAttributeNames())if(s.endsWith(ct)){let f=p[y++],c=d.getAttribute(s).split(ae),u=/([.?@])?(.*)/.exec(f);l.push({type:1,index:b,name:u[2],strings:c,ctor:u[1]==="."?Ke:u[1]==="?"?Ve:u[1]==="@"?Ye:ve}),d.removeAttribute(s)}else s.startsWith(ae)&&(l.push({type:6,index:b}),d.removeAttribute(s));if(Ot.test(d.tagName)){let s=d.textContent.split(ae),f=s.length-1;if(f>0){d.textContent=qe?qe.emptyScript:"";for(let c=0;c<f;c++)d.append(s[c],Be()),pe.nextNode(),l.push({type:2,index:++b});d.append(s[f],Be())}}}else if(d.nodeType===8)if(d.data===dt)l.push({type:2,index:b});else{let s=-1;for(;(s=d.data.indexOf(ae,s+1))!==-1;)l.push({type:7,index:b}),s+=ae.length-1}b++}}static createElement(i,e){let n=_e.createElement("template");return n.innerHTML=i,n}};function me(S,i,e=S,n){if(i===ge)return i;let d=n!==void 0?e._$Co?.[n]:e._$Cl,b=Me(i)?void 0:i._$litDirective$;return d?.constructor!==b&&(d?._$AO?.(!1),b===void 0?d=void 0:(d=new b(S),d._$AT(S,e,n)),n!==void 0?(e._$Co??(e._$Co=[]))[n]=d:e._$Cl=d),d!==void 0&&(i=me(S,d._$AS(S,i.values),d,n)),i}var je=class{constructor(i,e){this._$AV=[],this._$AN=void 0,this._$AD=i,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(i){let{el:{content:e},parts:n}=this._$AD,d=(i?.creationScope??_e).importNode(e,!0);pe.currentNode=d;let b=pe.nextNode(),y=0,r=0,l=n[0];for(;l!==void 0;){if(y===l.index){let _;l.type===2?_=new we(b,b.nextSibling,this,i):l.type===1?_=new l.ctor(b,l.name,l.strings,this,i):l.type===6&&(_=new Xe(b,this,i)),this._$AV.push(_),l=n[++r]}y!==l?.index&&(b=pe.nextNode(),y++)}return pe.currentNode=_e,d}p(i){let e=0;for(let n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(i,n,e),e+=n.strings.length-2):n._$AI(i[e])),e++}},we=class S{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(i,e,n,d){this.type=2,this._$AH=V,this._$AN=void 0,this._$AA=i,this._$AB=e,this._$AM=n,this.options=d,this._$Cv=d?.isConnected??!0}get parentNode(){let i=this._$AA.parentNode,e=this._$AM;return e!==void 0&&i?.nodeType===11&&(i=e.parentNode),i}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(i,e=this){i=me(this,i,e),Me(i)?i===V||i==null||i===""?(this._$AH!==V&&this._$AR(),this._$AH=V):i!==this._$AH&&i!==ge&&this._(i):i._$litType$!==void 0?this.$(i):i.nodeType!==void 0?this.T(i):Ht(i)?this.k(i):this._(i)}O(i){return this._$AA.parentNode.insertBefore(i,this._$AB)}T(i){this._$AH!==i&&(this._$AR(),this._$AH=this.O(i))}_(i){this._$AH!==V&&Me(this._$AH)?this._$AA.nextSibling.data=i:this.T(_e.createTextNode(i)),this._$AH=i}$(i){let{values:e,_$litType$:n}=i,d=typeof n=="number"?this._$AC(i):(n.el===void 0&&(n.el=Pe.createElement($t(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===d)this._$AH.p(e);else{let b=new je(d,this),y=b.u(this.options);b.p(e),this.T(y),this._$AH=b}}_$AC(i){let e=Dt.get(i.strings);return e===void 0&&Dt.set(i.strings,e=new Pe(i)),e}k(i){ut(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,n,d=0;for(let b of i)d===e.length?e.push(n=new S(this.O(Be()),this.O(Be()),this,this.options)):n=e[d],n._$AI(b),d++;d<e.length&&(this._$AR(n&&n._$AB.nextSibling,d),e.length=d)}_$AR(i=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);i&&i!==this._$AB;){let n=i.nextSibling;i.remove(),i=n}}setConnected(i){this._$AM===void 0&&(this._$Cv=i,this._$AP?.(i))}},ve=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(i,e,n,d,b){this.type=1,this._$AH=V,this._$AN=void 0,this.element=i,this.name=e,this._$AM=d,this.options=b,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=V}_$AI(i,e=this,n,d){let b=this.strings,y=!1;if(b===void 0)i=me(this,i,e,0),y=!Me(i)||i!==this._$AH&&i!==ge,y&&(this._$AH=i);else{let r=i,l,_;for(i=b[0],l=0;l<b.length-1;l++)_=me(this,r[n+l],e,l),_===ge&&(_=this._$AH[l]),y||(y=!Me(_)||_!==this._$AH[l]),_===V?i=V:i!==V&&(i+=(_??"")+b[l+1]),this._$AH[l]=_}y&&!d&&this.j(i)}j(i){i===V?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,i??"")}},Ke=class extends ve{constructor(){super(...arguments),this.type=3}j(i){this.element[this.name]=i===V?void 0:i}},Ve=class extends ve{constructor(){super(...arguments),this.type=4}j(i){this.element.toggleAttribute(this.name,!!i&&i!==V)}},Ye=class extends ve{constructor(i,e,n,d,b){super(i,e,n,d,b),this.type=5}_$AI(i,e=this){if((i=me(this,i,e,0)??V)===ge)return;let n=this._$AH,d=i===V&&n!==V||i.capture!==n.capture||i.once!==n.once||i.passive!==n.passive,b=i!==V&&(n===V||d);d&&this.element.removeEventListener(this.name,this,n),b&&this.element.addEventListener(this.name,this,i),this._$AH=i}handleEvent(i){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,i):this._$AH.handleEvent(i)}},Xe=class{constructor(i,e,n){this.element=i,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(i){me(this,i)}},Ut={M:ct,P:ae,A:dt,C:1,L:It,R:je,D:Ht,V:me,I:we,H:ve,N:Ve,U:Ye,B:Ke,F:Xe},yi=Le.litHtmlPolyfillSupport;yi?.(Pe,we),(Le.litHtmlVersions??(Le.litHtmlVersions=[])).push("3.3.0");var Nt=(S,i,e)=>{let n=e?.renderBefore??i,d=n._$litPart$;if(d===void 0){let b=e?.renderBefore??null;n._$litPart$=d=new we(i.insertBefore(Be(),b),b,void 0,e??{})}return d._$AI(S),d};var Re=globalThis,Z=class extends oe{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;let i=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=i.firstChild),i}update(i){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(i),this._$Do=Nt(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ge}};Z._$litElement$=!0,Z.finalized=!0,Re.litElementHydrateSupport?.({LitElement:Z});var Si=Re.litElementPolyfillSupport;Si?.({LitElement:Z});(Re.litElementVersions??(Re.litElementVersions=[])).push("4.2.0");var le=S=>(i,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(S,i)}):customElements.define(S,i)};var wi={attribute:!0,type:String,converter:Te,reflect:!1,hasChanged:ze},Ci=(S=wi,i,e)=>{let{kind:n,metadata:d}=e,b=globalThis.litPropertyMetadata.get(d);if(b===void 0&&globalThis.litPropertyMetadata.set(d,b=new Map),n==="setter"&&((S=Object.create(S)).wrapped=!0),b.set(e.name,S),n==="accessor"){let{name:y}=e;return{set(r){let l=i.get.call(this);i.set.call(this,r),this.requestUpdate(y,l,S)},init(r){return r!==void 0&&this.C(y,void 0,S,r),r}}}if(n==="setter"){let{name:y}=e;return function(r){let l=this[y];i.call(this,r),this.requestUpdate(y,l,S)}}throw Error("Unsupported decorator location: "+n)};function z(S){return(i,e)=>typeof e=="object"?Ci(S,i,e):((n,d,b)=>{let y=d.hasOwnProperty(b);return d.constructor.createProperty(b,n),y?Object.getOwnPropertyDescriptor(d,b):void 0})(S,i,e)}function K(S){return z({...S,state:!0,attribute:!1})}var{I:Hr}=Ut;var Ft=S=>S.strings===void 0;var Wt={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},pt=S=>(...i)=>({_$litDirective$:S,values:i}),Je=class{constructor(i){}get _$AU(){return this._$AM._$AU}_$AT(i,e,n){this._$Ct=i,this._$AM=e,this._$Ci=n}_$AS(i,e){return this.update(i,e)}update(i,e){return this.render(...e)}};var De=(S,i)=>{let e=S._$AN;if(e===void 0)return!1;for(let n of e)n._$AO?.(i,!1),De(n,i);return!0},Ze=S=>{let i,e;do{if((i=S._$AM)===void 0)break;e=i._$AN,e.delete(S),S=i}while(e?.size===0)},zt=S=>{for(let i;i=S._$AM;S=i){let e=i._$AN;if(e===void 0)i._$AN=e=new Set;else if(e.has(S))break;e.add(S),xi(i)}};function Ei(S){this._$AN!==void 0?(Ze(this),this._$AM=S,zt(this)):this._$AM=S}function Ai(S,i=!1,e=0){let n=this._$AH,d=this._$AN;if(d!==void 0&&d.size!==0)if(i)if(Array.isArray(n))for(let b=e;b<n.length;b++)De(n[b],!1),Ze(n[b]);else n!=null&&(De(n,!1),Ze(n));else De(this,S)}var xi=S=>{S.type==Wt.CHILD&&(S._$AP??(S._$AP=Ai),S._$AQ??(S._$AQ=Ei))},Qe=class extends Je{constructor(){super(...arguments),this._$AN=void 0}_$AT(i,e,n){super._$AT(i,e,n),zt(this),this.isConnected=i._$AU}_$AO(i,e=!0){i!==this.isConnected&&(this.isConnected=i,i?this.reconnected?.():this.disconnected?.()),e&&(De(this,i),Ze(this))}setValue(i){if(Ft(this._$Ct))this._$Ct._$AI(i,this);else{let e=[...this._$Ct._$AH];e[this._$Ci]=i,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}};var et=()=>new gt,gt=class{},_t=new WeakMap,tt=pt(class extends Qe{render(S){return V}update(S,[i]){let e=i!==this.G;return e&&this.G!==void 0&&this.rt(void 0),(e||this.lt!==this.ct)&&(this.G=i,this.ht=S.options?.host,this.rt(this.ct=S.element)),V}rt(S){if(this.isConnected||(S=void 0),typeof this.G=="function"){let i=this.ht??globalThis,e=_t.get(i);e===void 0&&(e=new WeakMap,_t.set(i,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,S),S!==void 0&&this.G.call(this.ht,S)}else this.G.value=S}get lt(){return typeof this.G=="function"?_t.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var ei=ci(jt());var Kt="terminal-shortcut",Ti=[{pattern:/\bctrl\+([a-z])\b/gi,keySequence:S=>`ctrl_${S[1].toLowerCase()}`},{pattern:/\bctrl\+([0-9])\b/gi,keySequence:S=>`ctrl_${S[1]}`},{pattern:/\bctrl\+f([1-9]|1[0-2])\b/gi,keySequence:S=>`ctrl_f${S[1]}`},{pattern:/\bctrl\+shift\+([a-z])\b/gi,keySequence:S=>`ctrl_shift_${S[1].toLowerCase()}`},{pattern:/\balt\+([a-z])\b/gi,keySequence:S=>`alt_${S[1].toLowerCase()}`},{pattern:/\bcmd\+([a-z])\b/gi,keySequence:S=>`cmd_${S[1].toLowerCase()}`},{pattern:/\bf([1-9]|1[0-2])\b/gi,keySequence:S=>`f${S[1]}`},{pattern:/\besc\b/gi,keySequence:()=>"escape"},{pattern:/\bescape\b/gi,keySequence:()=>"escape"},{pattern:/\btab\b/gi,keySequence:()=>"tab"},{pattern:/\bshift\+tab\b/gi,keySequence:()=>"shift_tab"},{pattern:/\benter\b/gi,keySequence:()=>"enter"},{pattern:/\breturn\b/gi,keySequence:()=>"enter"},{pattern:/\bbackspace\b/gi,keySequence:()=>"backspace"},{pattern:/\bdelete\b/gi,keySequence:()=>"delete"},{pattern:/\bspace\b/gi,keySequence:()=>" "},{pattern:/\barrow\s+(up|down|left|right)\b/gi,keySequence:S=>`arrow_${S[1].toLowerCase()}`},{pattern:/\b(up|down|left|right)\s+arrow\b/gi,keySequence:S=>`arrow_${S[1].toLowerCase()}`},{pattern:/\bpage\s+(up|down)\b/gi,keySequence:S=>`page_${S[1].toLowerCase()}`},{pattern:/\b(home|end)\b/gi,keySequence:S=>S[1].toLowerCase()},{pattern:/\besc\s+to\s+(interrupt|quit|exit|cancel)\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+esc\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+enter\b/gi,keySequence:()=>"enter"},{pattern:/\bpress\s+tab\b/gi,keySequence:()=>"tab"},{pattern:/\bpress\s+ctrl\+([a-z])\b/gi,keySequence:S=>`ctrl_${S[1].toLowerCase()}`},{pattern:/\bctrl\+([a-z])\s+to\s+\w+/gi,keySequence:S=>`ctrl_${S[1].toLowerCase()}`},{pattern:/\bq\s+to\s+(quit|exit)\b/gi,keySequence:()=>"q"},{pattern:/\bpress\s+q\b/gi,keySequence:()=>"q"},{pattern:/❯\s*(\d+)\.\s+.*/g,keySequence:S=>S[1]},{pattern:/(\d+)\.\s+.*/g,keySequence:S=>S[1]}];function Vt(S,i){new mt(S,i).process()}var mt=class{constructor(i,e){this.processedRanges=new Map;this.container=i,this.lines=i.querySelectorAll(".terminal-line"),this.onShortcutClick=e}process(){if(this.lines.length!==0)for(let i=0;i<this.lines.length;i++)this.processLine(i)}processLine(i){let e=this.getLineText(i);if(!e)return;let n=this.findShortcutsInLine(e);for(let d of n)this.isRangeProcessed(i,d.start,d.end)||(this.createShortcutLink(d,i),this.markRangeAsProcessed(i,d.start,d.end))}findShortcutsInLine(i){let e=[];for(let d of Ti){d.pattern.lastIndex=0;let b=d.pattern.exec(i);for(;b!==null;){let y=b[0],r=d.keySequence(b),l=b.index,_=b.index+y.length;e.push({text:y,keySequence:r,start:l,end:_}),b=d.pattern.exec(i)}}e.sort((d,b)=>d.start-b.start);let n=[];for(let d of e)n.some(y=>d.start<y.end&&d.end>y.start)||n.push(d);return n}createShortcutLink(i,e){let n=this.lines[e];new vt(n,i,this.onShortcutClick).createLink()}getLineText(i){return i<0||i>=this.lines.length?"":this.lines[i].textContent||""}isRangeProcessed(i,e,n){let d=this.processedRanges.get(i);return d?d.some(b=>e<b.end&&n>b.start):!1}markRangeAsProcessed(i,e,n){this.processedRanges.has(i)||this.processedRanges.set(i,[]);let d=this.processedRanges.get(i);d&&d.push({start:e,end:n})}},vt=class{constructor(i,e,n){this.lineElement=i,this.shortcut=e,this.onShortcutClick=n}createLink(){this.wrapTextInLink(this.lineElement,this.shortcut.start,this.shortcut.end)}wrapTextInLink(i,e,n){let d=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,null),b=[],y=0,r=d.nextNode();for(;r;){let l=r,_=l.textContent||"",p=y,s=y+_.length;s>e&&p<n&&b.push({node:l,start:p,end:s}),y=s,r=d.nextNode()}for(let l=b.length-1;l>=0;l--){let{node:_,start:p}=b[l],s=_.textContent||"",f=Math.max(0,e-p),c=Math.min(s.length,n-p);f<c&&this.wrapTextNode(_,f,c)}}wrapTextNode(i,e,n){let d=i.parentNode;if(!d||this.isInsideClickable(d))return;let b=i.textContent||"",y=b.substring(0,e),r=b.substring(e,n),l=b.substring(n),_=this.createShortcutElement(r),p=document.createDocumentFragment();y&&p.appendChild(document.createTextNode(y)),p.appendChild(_),l&&p.appendChild(document.createTextNode(l)),d.replaceChild(p,i)}createShortcutElement(i){let e=document.createElement("span");return e.className=Kt,e.style.color="#9ca3af",e.style.textDecoration="underline",e.style.textDecorationStyle="dotted",e.style.cursor="pointer",e.style.fontWeight="500",e.textContent=i,e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.onShortcutClick(this.shortcut.keySequence)}),e.addEventListener("mouseenter",()=>{e.style.backgroundColor="rgba(156, 163, 175, 0.2)",e.style.color="#d1d5db"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="",e.style.color="#9ca3af"}),e.title=`Click to send: ${this.shortcut.keySequence}`,e}isInsideClickable(i){let e=i;for(;e&&e!==document.body;){if(e.tagName==="A"&&e.classList.contains("terminal-link")||e.tagName==="SPAN"&&e.classList.contains(Kt))return!0;e=e.parentElement}return!1}};He();var Di=["https://","http://","file://"],Jt="terminal-link",nt=/https?:\/\/|file:\/\//g,Hi=/(^|\s)(h|ht|htt|http|https|https:|https:\/|https:\/\/|f|fi|fil|file|file:|file:\/|file:\/\/)$/,bt=/^[a-zA-Z0-9[\].-]/,Oi=/^[/a-zA-Z0-9[\].-]/,Zt=/[^\w\-._~:/?#[\]@!$&'()*+,;=%{}|\\^`]/,$i=/^(https?:\/\/(localhost|[\d.]+|\[[\da-fA-F:]+\]|(([a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.)*[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.[a-zA-Z]+))(:\d+)?.*|file:\/\/.+)/,Ii=/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$/;function Ui(S){new yt(S).process()}var yt=class{constructor(i){this.processedRanges=new Map;this.container=i,this.lines=i.querySelectorAll(".terminal-line")}process(){if(this.lines.length!==0)for(let i=0;i<this.lines.length;i++)this.processLine(i)}processLine(i){i>0&&this.checkPreviousLineContinuation(i),this.findUrlsInLine(i)}checkPreviousLineContinuation(i){let e=this.getLineText(i),n=this.getLineText(i-1),d=this.findIncompleteUrlAtLineEnd(n,e);if(d){let{startPos:b}=d,y=this.buildMultiLineUrl(i-1,b);y&&this.isValidUrl(y.url)&&(this.isRangeProcessed(i-1,b,y.endLine)||(this.createUrlLinks(y.url,i-1,y.endLine,b),this.markRangeAsProcessed(i-1,y.endLine,b,y.url)))}}findIncompleteUrlAtLineEnd(i,e){for(let d of Di){let b=i.lastIndexOf(d);if(b>=0&&i.endsWith(d)&&bt.test(e.trimStart()))return{startPos:b,protocol:d}}let n=i.match(Hi);if(n){let d=n[2],b=(n.index??0)+(n[1]?1:0);if(this.isValidContinuation(d,e))return{startPos:b,protocol:d}}return null}isValidContinuation(i,e){let n=e.trimStart();if(i==="https://"||i==="file://")return bt.test(n);if(i.endsWith("/"))return Oi.test(n);let d=i+n;return/^(https?:\/\/|file:\/\/)/.test(d)}isValidUrlContinuation(i,e){let n=e.trimStart();if(!n)return!1;if(!i.includes("://")){let b=i+n;return/^(https?:|file:|https?:\/|file:\/|https?:\/\/|file:\/\/)/.test(b)}if(i.match(/(https?:|file:)\/\/$/))return bt.test(n);if(/^(and|or|but|the|is|are|was|were|been|have|has|had|will|would|could|should|may|might|check|visit|go|see|click|open|navigate)\b/i.test(n)||/^[!?;]/.test(n)||/^\.(\s|$)/.test(n))return!1;let d=n.split(/\s/)[0];return/[/:._-]/.test(d)?!0:/^[a-zA-Z]+$/.test(d)&&d.length>2?!/^(next|line|with|text|this|that|then|when|where|which|while|after|before|during|since|until|above|below|between|into|through|under|over|about|against|among|around|behind|beside|beyond|inside|outside|toward|within|without|according|although|because|however|therefore|moreover|nevertheless|furthermore|otherwise|meanwhile|indeed|instead|likewise|similarly|specifically|subsequently|ultimately|additionally|consequently|eventually|finally|initially|particularly|previously|recently|suddenly|usually)/i.test(d):/^[a-zA-Z0-9._~:/?#[\]@!$&'()*+,;=%-]/.test(n)}findUrlsInLine(i){let e=this.getLineText(i);nt.lastIndex=0;let n=nt.exec(e);for(;n!==null;){let d=n.index;if(this.isPositionProcessed(i,d)){n=nt.exec(e);continue}let b=this.buildMultiLineUrl(i,d);b&&this.isValidUrl(b.url)&&(this.createUrlLinks(b.url,i,b.endLine,d),this.markRangeAsProcessed(i,b.endLine,d,b.url)),n=nt.exec(e)}}buildMultiLineUrl(i,e){let n="",d=i;for(let b=i;b<this.lines.length;b++){let y=this.getLineText(b),r;if(b===i)r=y.substring(e);else{let _=n;if(!this.isValidUrlContinuation(_,y)){d=b-1;break}if(r=y.trimStart(),!r){d=b-1;break}}let l=this.findUrlEndInText(r);if(l>=0){n+=r.substring(0,l),d=b;break}else if(n+=r,d=b,b===this.lines.length-1)break}return{url:this.cleanUrl(n),endLine:d}}findUrlEndInText(i){let e=i.search(/\s/);if(e>=0)return e;let n=i.match(Zt);return n&&n.index!==void 0?n.index:-1}createUrlLinks(i,e,n,d){new St(this.lines,i).createLinks(e,n,d)}getLineText(i){return i<0||i>=this.lines.length?"":this.lines[i].textContent||""}isValidUrl(i){if(i.length<7||i.length>2048||/[\n\r\t]/.test(i)||!$i.test(i))return!1;try{let e=new URL(i);if(!["http:","https:","file:"].includes(e.protocol))return!1;if(e.protocol==="http:"||e.protocol==="https:"){let n=e.hostname;if(n==="localhost"||/^[\d.]+$/.test(n)||n.startsWith("["))return!0;let d=n.split(".");if(d.length<2)return!1;for(let y=0;y<d.length;y++)if(!Ii.test(d[y]))return!1;let b=d[d.length-1];if(!/[a-zA-Z]/.test(b))return!1}return!0}catch{return!1}}cleanUrl(i){let e=i,n=(e.match(/\(/g)||[]).length,d=(e.match(/\)/g)||[]).length;if(d>n){let b=d-n;e=e.replace(/\)+$/,y=>y.substring(0,y.length-b))}return e=e.replace(/[.,;:!?]+$/,""),e}isRangeProcessed(i,e,n){for(let d=i;d<=n;d++)if(this.isPositionProcessed(d,d===i?e:0))return!0;return!1}isPositionProcessed(i,e){let n=this.processedRanges.get(i);return n?n.some(d=>e>=d.start&&e<d.end):!1}markRangeAsProcessed(i,e,n,d){let b=d,y=i;for(;y<=e&&b.length>0;){let r=this.getLineText(y);this.processedRanges.has(y)||this.processedRanges.set(y,[]);let l=this.processedRanges.get(y);if(!l)continue;let _,p;if(y===i){_=n;let s=r.substring(n),f=Math.min(s.length,b.length);p=n+f}else{let s=r.match(/^\s*/);_=s?s[0].length:0;let f=r.substring(_),c=Math.min(f.length,b.length);if(y===e){let u=f.substring(0,c).search(Zt);u>=0&&(c=u)}p=_+c}l.push({start:_,end:p}),b=b.substring(p-_),y++}}},St=class{constructor(i,e){this.lines=i,this.url=e}createLinks(i,e,n){let d=this.url;for(let b=i;b<=e;b++){let y=this.lines[b],r=y.textContent||"",l,_;if(b===i){l=n;let p=r.substring(n);_=n+Math.min(p.length,d.length)}else{let p=r.match(/^\s*/);l=p?p[0].length:0;let s=r.substring(l),f=Math.min(s.length,d.length),c=s.match(/[\s<>"'`]/),u=c?Math.min(c.index??f,f):f;_=l+u}if(l<_&&(this.wrapTextInLink(y,l,_),d=d.substring(_-l)),d.length===0)break}}wrapTextInLink(i,e,n){let d=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,null),b=[],y=0,r=d.nextNode();for(;r;){let l=r,_=l.textContent||"",p=y,s=y+_.length;s>e&&p<n&&b.push({node:l,start:p,end:s}),y=s,r=d.nextNode()}for(let l=b.length-1;l>=0;l--){let{node:_,start:p}=b[l],s=_.textContent||"",f=Math.max(0,e-p),c=Math.min(s.length,n-p);f<c&&this.wrapTextNode(_,f,c)}}wrapTextNode(i,e,n){let d=i.parentNode;if(!d||this.isInsideLink(d))return;let b=i.textContent||"",y=b.substring(0,e),r=b.substring(e,n),l=b.substring(n),_=this.createLinkElement(r),p=document.createDocumentFragment();y&&p.appendChild(document.createTextNode(y)),p.appendChild(_),l&&p.appendChild(document.createTextNode(l)),d.replaceChild(p,i)}createLinkElement(i){let e=document.createElement("a");return e.className=Jt,e.href=this.url,e.target="_blank",e.rel="noopener noreferrer",e.style.color="#4fc3f7",e.style.textDecoration="underline",e.style.cursor="pointer",e.textContent=i,e.addEventListener("mouseenter",()=>{e.style.backgroundColor="rgba(79, 195, 247, 0.2)"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor=""}),e}isInsideLink(i){let e=i;for(;e&&e!==document.body;){if(e.tagName==="A"&&e.classList.contains(Jt))return!0;e=e.parentElement}return!1}},Qt={processLinks:Ui};var Ce=ce("terminal"),Y=class extends Z{constructor(){super(...arguments);this.sessionId="";this.sessionStatus="running";this.cols=80;this.rows=24;this.fontSize=14;this.fitHorizontally=!1;this.maxCols=0;this.disableClick=!1;this.hideScrollButton=!1;this.initialCols=0;this.initialRows=0;this.originalFontSize=14;this.userOverrideWidth=!1;this.terminal=null;this._viewportY=0;this.followCursorEnabled=!0;this.programmaticScroll=!1;this.debugMode=!1;this.renderCount=0;this.totalRenderTime=0;this.lastRenderTime=0;this.actualRows=24;this.cursorVisible=!0;this.container=null;this.resizeTimeout=null;this.explicitSizeSet=!1;this.renderPending=!1;this.momentumVelocityY=0;this.momentumVelocityX=0;this.momentumAnimation=null;this.resizeObserver=null;this.operationQueue=[];this.handleScrollToBottom=()=>{this.followCursorEnabled=!0,this.scrollToBottom(),this.requestUpdate()};this.handleFitToggle=()=>{if(!this.terminal||!this.container){this.fitHorizontally=!this.fitHorizontally,this.requestUpdate();return}let e=this.terminal.buffer.active,n=this.fontSize*1.2,d=n>0?this.viewportY/n:0,b=this.isScrolledToBottom();if(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.fitHorizontally=!this.fitHorizontally,this.fitHorizontally||(this.fontSize=this.originalFontSize),this.fitTerminal(),b)this.scrollToBottom();else{let y=this.fontSize*1.2,r=Math.max(0,(e.length-this.actualRows)*y),l=d*y;this.viewportY=Math.max(0,Math.min(r,l))}this.requestUpdate()};this.handlePaste=e=>{e.preventDefault(),e.stopPropagation();let n=e.clipboardData?.getData("text/plain");n&&this.dispatchEvent(new CustomEvent("terminal-paste",{detail:{text:n},bubbles:!0}))};this.handleClick=()=>{this.disableClick||this.container&&this.container.focus()};this.handleShortcutClick=e=>{this.dispatchEvent(new CustomEvent("terminal-input",{detail:{text:e},bubbles:!0}))}}createRenderRoot(){return this}get viewportY(){return this._viewportY}set viewportY(e){this._viewportY=e}queueRenderOperation(e){this.operationQueue.push(e),this.renderPending||(this.renderPending=!0,requestAnimationFrame(()=>{this.processOperationQueue(),this.renderPending=!1}))}requestRenderBuffer(){this.queueRenderOperation(()=>{})}async processOperationQueue(){for(;this.operationQueue.length>0;){let e=this.operationQueue.shift();e&&await e()}this.renderBuffer()}connectedCallback(){if(super.connectedCallback(),this.debugMode=new URLSearchParams(window.location.search).has("debug"),this.sessionId)try{let e=localStorage.getItem(`terminal-width-override-${this.sessionId}`);e!==null&&(this.userOverrideWidth=e==="true")}catch(e){Ce.warn("Failed to load terminal width preference from localStorage:",e)}}updated(e){if(e.has("sessionId")&&this.sessionId)try{let n=localStorage.getItem(`terminal-width-override-${this.sessionId}`);n!==null&&(this.userOverrideWidth=n==="true",this.container&&this.fitTerminal())}catch(n){Ce.warn("Failed to load terminal width preference from localStorage:",n)}(e.has("cols")||e.has("rows"))&&(this.terminal&&!this.explicitSizeSet&&this.reinitializeTerminal(),this.explicitSizeSet=!1),e.has("fontSize")&&(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.terminal&&this.container&&this.fitTerminal()),e.has("fitHorizontally")&&(this.fitHorizontally||(this.fontSize=this.originalFontSize),this.fitTerminal()),e.has("maxCols")&&this.terminal&&this.container&&this.fitTerminal()}disconnectedCallback(){this.cleanup(),super.disconnectedCallback()}setUserOverrideWidth(e){if(this.userOverrideWidth=e,this.sessionId)try{localStorage.setItem(`terminal-width-override-${this.sessionId}`,String(e))}catch(n){Ce.warn("Failed to save terminal width preference to localStorage:",n)}this.container&&this.fitTerminal()}cleanup(){this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.terminal&&(this.terminal.dispose(),this.terminal=null)}firstUpdated(){this.originalFontSize=this.fontSize,this.initializeTerminal()}async initializeTerminal(){try{if(this.requestUpdate(),this.container=this.querySelector("#terminal-container"),!this.container){let e=new Error("Terminal container not found");throw Ce.error("terminal container not found",e),e}await this.setupTerminal(),this.setupResize(),this.setupScrolling(),this.requestUpdate()}catch(e){Ce.error("failed to initialize terminal:",e),this.requestUpdate()}}async reinitializeTerminal(){if(this.terminal){this.container&&this.container.offsetHeight;let e=Number.isFinite(this.cols)?Math.floor(this.cols):80,n=Number.isFinite(this.rows)?Math.floor(this.rows):24;this.terminal.resize(e,n),this.fitTerminal()}}async setupTerminal(){try{this.terminal=new ei.Terminal({cursorBlink:!0,cursorStyle:"block",cursorWidth:1,lineHeight:1.2,letterSpacing:0,scrollback:1e4,allowProposedApi:!0,allowTransparency:!1,convertEol:!0,drawBoldTextInBrightColors:!0,minimumContrastRatio:1,macOptionIsMeta:!0,altClickMovesCursor:!0,rightClickSelectsWord:!1,wordSeparator:" ()[]{}'\"`",theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#00ff00",cursorAccent:"#1e1e1e",black:"#000000",red:"#cd0000",green:"#00cd00",yellow:"#cdcd00",blue:"#0000ee",magenta:"#cd00cd",cyan:"#00cdcd",white:"#e5e5e5",brightBlack:"#7f7f7f",brightRed:"#ff0000",brightGreen:"#00ff00",brightYellow:"#ffff00",brightBlue:"#5c5cff",brightMagenta:"#ff00ff",brightCyan:"#00ffff",brightWhite:"#ffffff"}}),this.terminal.resize(this.cols,this.rows)}catch(e){throw Ce.error("failed to create terminal:",e),e}}measureCharacterWidth(){if(!this.container)return 8;let e=document.createElement("div");e.className="terminal-line",e.style.position="absolute",e.style.visibility="hidden",e.style.top="0",e.style.left="0",e.style.fontSize=`${this.fontSize}px`,e.style.fontFamily="Hack Nerd Font Mono, Fira Code, monospace";let n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",d=Math.ceil(this.cols/n.length),b=n.repeat(d).substring(0,this.cols);e.textContent=b,this.container.appendChild(e);let r=e.getBoundingClientRect().width/this.cols;return this.container.removeChild(e),Number.isFinite(r)&&r>0?r:8}fitTerminal(){if(!this.terminal||!this.container)return;let e=this.actualRows,n=this.fontSize*1.2,d=this.isScrolledToBottom(),b=n>0?this.viewportY/n:0;if(this.fitHorizontally){let y=this.container.clientWidth,r=this.container.clientHeight,l=y/this.cols,_=this.measureCharacterWidth(),p=l/_,s=this.fontSize*p,f=Math.max(4,Math.min(32,s));this.fontSize=f;let c=this.fontSize*1.2,u=Math.max(1,Math.floor(r/c));if(this.actualRows=u,this.rows=u,this.terminal){let m=Number.isFinite(this.cols)?Math.floor(this.cols):80,t=Number.isFinite(this.rows)?Math.floor(this.rows):24;this.terminal.resize(m,t),this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:this.cols,rows:this.rows},bubbles:!0}))}}else{let y=this.container.clientWidth||800,r=this.container.clientHeight||600,l=this.fontSize*1.2,_=this.measureCharacterWidth(),p=Number.isFinite(_)&&_>0?_:8,s=Math.max(20,Math.floor(y/p))-1,f=this.sessionId.startsWith("fwd_");if(this.maxCols>0?this.cols=Math.min(s,this.maxCols):this.userOverrideWidth?this.cols=s:this.initialCols>0&&f?this.cols=Math.min(s,this.initialCols):this.cols=s,this.rows=Math.max(6,Math.floor(r/l)),this.actualRows=this.rows,this.terminal){let c=Number.isFinite(this.cols)?Math.floor(this.cols):80,u=Number.isFinite(this.rows)?Math.floor(this.rows):24;this.terminal.resize(c,u),this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:this.cols,rows:this.rows},bubbles:!0}))}}if(this.terminal){let y=this.terminal.buffer.active,r=this.fontSize*1.2,l=Math.max(0,(y.length-this.actualRows)*r);if(d)this.viewportY=l;else{let _=b*r,p=Math.max(0,Math.min(l,_));this.viewportY=p}}this.requestRenderBuffer(),this.requestUpdate()}setupResize(){this.container&&(this.resizeObserver=new ResizeObserver(()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.fitTerminal()},50)}),this.resizeObserver.observe(this.container),window.addEventListener("resize",()=>{this.fitTerminal()}))}setupScrolling(){if(!this.container)return;this.container.addEventListener("wheel",p=>{p.preventDefault();let s=this.fontSize*1.2,f=0,c=0;switch(p.deltaMode){case WheelEvent.DOM_DELTA_PIXEL:f=p.deltaY,c=p.deltaX;break;case WheelEvent.DOM_DELTA_LINE:f=p.deltaY*s,c=p.deltaX*s;break;case WheelEvent.DOM_DELTA_PAGE:f=p.deltaY*(this.actualRows*s),c=p.deltaX*(this.actualRows*s);break}let u=.5;f*=u,c*=u,Math.abs(f)>0&&this.scrollViewportPixels(f),Math.abs(c)>0&&!this.fitHorizontally&&this.container&&(this.container.scrollLeft+=c)},{passive:!1});let e=!1,n=0,d=0,b=[],y=p=>{p.pointerType!=="touch"||!p.isPrimary||(this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),e=!1,n=p.clientY,d=p.clientX,b=[{y:p.clientY,x:p.clientX,time:performance.now()}],this.container?.setPointerCapture(p.pointerId))},r=p=>{if(p.pointerType!=="touch"||!this.container?.hasPointerCapture(p.pointerId))return;let s=p.clientY,f=p.clientX,c=n-s,u=d-f,m=performance.now();b.push({y:s,x:f,time:m}),b.length>5&&b.shift(),!e&&(Math.abs(c)>5||Math.abs(u)>5)&&(e=!0),e&&(Math.abs(c)>0&&(this.scrollViewportPixels(c),n=s),Math.abs(u)>0&&!this.fitHorizontally&&(this.container.scrollLeft+=u,d=f))},l=p=>{if(p.pointerType==="touch"){if(e&&b.length>=2){let s=performance.now(),f=b[b.length-1],c=b[b.length-2],u=s-c.time,m=f.y-c.y,t=f.x-c.x,o=u>0?-m/u:0,h=u>0?-t/u:0,a=.3;(Math.abs(o)>a||Math.abs(h)>a)&&this.startMomentum(o,h)}this.container?.releasePointerCapture(p.pointerId)}},_=p=>{p.pointerType==="touch"&&this.container?.releasePointerCapture(p.pointerId)};this.container.addEventListener("pointerdown",y),this.container.addEventListener("pointermove",r),this.container.addEventListener("pointerup",l),this.container.addEventListener("pointercancel",_)}scrollViewport(e){if(!this.terminal)return;let n=this.fontSize*1.2,d=e*n;this.scrollViewportPixels(d)}scrollViewportPixels(e){if(!this.terminal)return;let n=this.terminal.buffer.active,d=this.fontSize*1.2,b=Math.max(0,(n.length-this.actualRows)*d),y=Math.max(0,Math.min(b,this.viewportY+e));y!==this.viewportY&&(this.viewportY=y,this.updateFollowCursorState(),this.requestRenderBuffer())}startMomentum(e,n){this.momentumVelocityY=e*16,this.momentumVelocityX=n*16,this.momentumAnimation&&cancelAnimationFrame(this.momentumAnimation),this.animateMomentum()}animateMomentum(){let d=this.momentumVelocityY,b=this.momentumVelocityX,y=!1;if(Math.abs(d)>.1){let r=this.terminal?.buffer.active;if(r){let l=this.fontSize*1.2,_=Math.max(0,(r.length-this.actualRows)*l),p=Math.max(0,Math.min(_,this.viewportY+d));p!==this.viewportY?(this.viewportY=p,y=!0,this.updateFollowCursorState()):this.momentumVelocityY=0}}if(Math.abs(b)>.1&&!this.fitHorizontally&&this.container){let r=this.container.scrollLeft+b;this.container.scrollLeft=r,y=!0}this.momentumVelocityY*=.92,this.momentumVelocityX*=.92,Math.abs(this.momentumVelocityY)>.1||Math.abs(this.momentumVelocityX)>.1?(this.momentumAnimation=requestAnimationFrame(()=>{this.animateMomentum()}),y&&this.renderBuffer()):(this.momentumAnimation=null,this.momentumVelocityY=0,this.momentumVelocityX=0)}renderBuffer(){if(!this.terminal||!this.container)return;let e=this.debugMode?performance.now():0;this.debugMode&&this.renderCount++;let n=this.terminal.buffer.active,d=n.length,b=this.fontSize*1.2,y=this.viewportY/b,r=Math.floor(y),l=(y-r)*b,_="",p=n.getNullCell(),s=this.terminal.buffer.active.cursorX,f=this.terminal.buffer.active.cursorY+this.terminal.buffer.active.viewportY;for(let c=0;c<this.actualRows;c++){let u=r+c,m=l>0?` style="transform: translateY(-${l}px);"`:"";if(u>=d){_+=`<div class="terminal-line"${m}></div>`;continue}let t=n.getLine(u);if(!t){_+=`<div class="terminal-line"${m}></div>`;continue}let o=u===f,h=this.renderLine(t,p,o&&this.cursorVisible?s:-1);_+=`<div class="terminal-line"${m}>${h||""}</div>`}if(this.container.innerHTML=_,Qt.processLinks(this.container),Vt(this.container,this.handleShortcutClick),this.debugMode){let c=performance.now();this.lastRenderTime=c-e,this.totalRenderTime+=this.lastRenderTime,this.requestUpdate()}}renderLine(e,n,d=-1){let b="",y="",r="",l="",_=s=>s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),p=()=>{if(y){let s=_(y);b+=`<span class="${r}"${l?` style="${l}"`:""}>${s}</span>`,y=""}};for(let s=0;s<e.length;s++){if(e.getCell(s,n),!n)continue;let f=n.getChars()||" ";if(n.getWidth()===0)continue;let u="terminal-char",m="",t=s===d;t&&(u+=" cursor");let o=n.getFgColor();if(o!==void 0){if(typeof o=="number"&&o>=0&&o<=255)m+=`color: var(--terminal-color-${o});`;else if(typeof o=="number"&&o>255){let M=o>>16&255,B=o>>8&255,D=o&255;m+=`color: rgb(${M}, ${B}, ${D});`}}let h=n.getBgColor();if(h!==void 0){if(typeof h=="number"&&h>=0&&h<=255)m+=`background-color: var(--terminal-color-${h});`;else if(typeof h=="number"&&h>255){let M=h>>16&255,B=h>>8&255,D=h&255;m+=`background-color: rgb(${M}, ${B}, ${D});`}}let a=n.isBold(),v=n.isItalic(),w=n.isUnderline(),T=n.isDim(),L=n.isInverse(),k=n.isInvisible(),R=n.isStrikethrough(),q=n.isOverline();if(a&&(u+=" bold"),v&&(u+=" italic"),w&&(u+=" underline"),T&&(u+=" dim"),R&&(u+=" strikethrough"),q&&(u+=" overline"),L){let M=m.match(/color: ([^;]+);/)?.[1],B=m.match(/background-color: ([^;]+);/)?.[1],D="#e4e4e4",se="#0a0a0a",ee=M||D,N=B||se;m="",m+=`color: ${N};`,m+=`background-color: ${ee};`}t&&(m+="background-color: #23d18b;"),k&&(m+="opacity: 0;"),(u!==r||m!==l)&&(p(),r=u,l=m),y+=f}return p(),b}write(e,n=!0){this.terminal&&(e.includes("\x1B[?25l")&&(this.cursorVisible=!1),e.includes("\x1B[?25h")&&(this.cursorVisible=!0),this.queueRenderOperation(async()=>{if(this.terminal&&(await new Promise(d=>{this.terminal?this.terminal.write(e,d):d()}),n&&this.followCursorEnabled)){let d=this.terminal.buffer.active,b=this.fontSize*1.2,y=Math.max(0,(d.length-this.actualRows)*b);this.programmaticScroll=!0,this.viewportY=y,this.programmaticScroll=!1}}))}clear(){this.terminal&&this.queueRenderOperation(()=>{this.terminal&&(this.terminal.clear(),this.viewportY=0)})}setTerminalSize(e,n){this.cols=e,this.rows=n,this.terminal&&(this.explicitSizeSet=!0,this.queueRenderOperation(()=>{this.terminal&&(this.terminal.resize(e,n),this.requestUpdate())}))}scrollToBottom(){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;this.fitTerminal();let e=this.terminal.buffer.active,n=this.fontSize*1.2,d=Math.max(0,(e.length-this.actualRows)*n);this.programmaticScroll=!0,this.viewportY=d,this.programmaticScroll=!1})}scrollToPosition(e){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;let n=this.terminal.buffer.active,d=this.fontSize*1.2,b=Math.max(0,n.length-this.actualRows);this.programmaticScroll=!0,this.viewportY=Math.max(0,Math.min(b,e))*d,this.programmaticScroll=!1})}queueCallback(e){this.queueRenderOperation(e)}getTerminalSize(){return{cols:this.cols,rows:this.rows}}getVisibleRows(){return this.actualRows}getBufferSize(){return this.terminal?this.terminal.buffer.active.length:0}getScrollPosition(){let e=this.fontSize*1.2;return Math.round(this.viewportY/e)}getMaxScrollPosition(){if(!this.terminal)return 0;let e=this.terminal.buffer.active;return Math.max(0,e.length-this.actualRows)}followCursor(){if(!this.terminal)return;let e=this.terminal.buffer.active,n=e.cursorY+e.viewportY,d=this.fontSize*1.2,b=n,y=Math.floor(this.viewportY/d),r=y+this.actualRows-1;this.programmaticScroll=!0,b<y?this.viewportY=b*d:b>r&&(this.viewportY=Math.max(0,(b-this.actualRows+1)*d));let l=Math.max(0,(e.length-this.actualRows)*d);this.viewportY=Math.min(this.viewportY,l),this.programmaticScroll=!1}isScrolledToBottom(){if(!this.terminal)return!0;let e=this.terminal.buffer.active,n=this.fontSize*1.2,d=Math.max(0,(e.length-this.actualRows)*n);return this.viewportY>=d-n}updateFollowCursorState(){if(this.programmaticScroll)return;let e=this.isScrolledToBottom();e&&!this.followCursorEnabled?this.followCursorEnabled=!0:!e&&this.followCursorEnabled&&(this.followCursorEnabled=!1)}render(){return Q`
      <style>
        /* Dynamic terminal sizing */
        .terminal-container {
          font-size: ${this.fontSize}px;
          line-height: ${this.fontSize*1.2}px;
          touch-action: none !important;
        }

        .terminal-line {
          height: ${this.fontSize*1.2}px;
          line-height: ${this.fontSize*1.2}px;
        }
      </style>
      <div class="relative w-full h-full p-0 m-0">
        <div
          id="terminal-container"
          class="terminal-container w-full h-full overflow-hidden p-0 m-0"
          tabindex="0"
          contenteditable="false"
          style="view-transition-name: session-${this.sessionId}"
          @paste=${this.handlePaste}
          @click=${this.handleClick}
          data-testid="terminal-container"
        ></div>
        ${!this.followCursorEnabled&&!this.hideScrollButton?Q`
              <div
                class="scroll-to-bottom"
                @click=${this.handleScrollToBottom}
                title="Scroll to bottom"
              >
                ↓
              </div>
            `:""}
        ${this.debugMode?Q`
              <div class="debug-overlay">
                <div class="metric">
                  <span class="metric-label">Renders:</span>
                  <span class="metric-value">${this.renderCount}</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Avg:</span>
                  <span class="metric-value"
                    >${this.renderCount>0?(this.totalRenderTime/this.renderCount).toFixed(2):"0.00"}ms</span
                  >
                </div>
                <div class="metric">
                  <span class="metric-label">Last:</span>
                  <span class="metric-value">${this.lastRenderTime.toFixed(2)}ms</span>
                </div>
              </div>
            `:""}
      </div>
    `}};O([z({type:String})],Y.prototype,"sessionId",2),O([z({type:String})],Y.prototype,"sessionStatus",2),O([z({type:Number})],Y.prototype,"cols",2),O([z({type:Number})],Y.prototype,"rows",2),O([z({type:Number})],Y.prototype,"fontSize",2),O([z({type:Boolean})],Y.prototype,"fitHorizontally",2),O([z({type:Number})],Y.prototype,"maxCols",2),O([z({type:Boolean})],Y.prototype,"disableClick",2),O([z({type:Boolean})],Y.prototype,"hideScrollButton",2),O([z({type:Number})],Y.prototype,"initialCols",2),O([z({type:Number})],Y.prototype,"initialRows",2),O([K()],Y.prototype,"terminal",2),O([K()],Y.prototype,"followCursorEnabled",2),O([K()],Y.prototype,"actualRows",2),O([K()],Y.prototype,"cursorVisible",2),Y=O([le("vibe-terminal")],Y);var be=class extends Z{constructor(){super(...arguments);this.cols=80;this.rows=24;this.inputText="";this.terminalRef=et();this.testData={ansi:"\x1B[31mRed\x1B[0m \x1B[32mGreen\x1B[0m \x1B[34mBlue\x1B[0m \x1B[1;33mBold Yellow\x1B[0m",unicode:"\u{1F680} Unicode: \u4F60\u597D\u4E16\u754C \u2022 \xF1 \u2022 \xFC \u2022 \xF6 \u2022 \u{1F3A8}",longLine:"This is a very long line that should wrap around when it reaches the edge of the terminal. ".repeat(5),progress:"[##########          ] 50% Complete"}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.setupTerminal()}async setupTerminal(){await this.updateComplete;let e=this.terminalRef.value;e&&e.addEventListener("terminal-ready",()=>{this.writeWelcomeMessage()})}writeWelcomeMessage(){let e=this.terminalRef.value;e&&(e.write(`\x1B[1;36mVibeTunnel Terminal Test\x1B[0m\r
`),e.write(`=====================================\r
\r
`),e.write(`This is a test environment for the terminal component.\r
`),e.write(`Use the buttons above to test various features.\r
\r
`),e.write("\x1B[32m$ \x1B[0m"))}handleTerminalInput(e){let n=this.terminalRef.value;if(!n)return;let d=e.detail;n.write(d),d==="\r"&&n.write(`
\x1B[32m$ \x1B[0m`)}handleTerminalResize(e){console.log("Terminal resized:",e.detail)}clearTerminal(){let e=this.terminalRef.value;e&&(e.clear(),e.write("\x1B[32m$ \x1B[0m"))}writeTestData(e){let n=this.terminalRef.value;n&&n.write(`${this.testData[e]}\r
\x1B[32m$ \x1B[0m`)}resizeTerminal(e,n){this.cols=e,this.rows=n;let d=this.terminalRef.value;d&&d.setTerminalSize(e,n)}sendCustomInput(){if(!this.inputText)return;let e=this.terminalRef.value;e&&(e.write(`${this.inputText}\r
\x1B[32m$ \x1B[0m`),this.inputText="")}render(){return Q`
      <div class="h-screen flex flex-col bg-background text-foreground font-mono">
        <div class="bg-surface border-b border-gray-800 p-4 font-sans">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Terminal Test</h1>
          <div class="flex gap-2 flex-wrap">
            <button
              @click=${this.clearTerminal}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Clear
            </button>
            <button
              @click=${()=>this.writeTestData("ansi")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              ANSI Colors
            </button>
            <button
              @click=${()=>this.writeTestData("unicode")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Unicode
            </button>
            <button
              @click=${()=>this.writeTestData("longLine")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Long Line
            </button>
            <button
              @click=${()=>this.writeTestData("progress")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Progress Bar
            </button>
            <button
              @click=${()=>this.resizeTerminal(80,24)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              80x24
            </button>
            <button
              @click=${()=>this.resizeTerminal(120,30)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              120x30
            </button>
            <button
              @click=${()=>this.resizeTerminal(40,15)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              40x15
            </button>
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden bg-black m-4 rounded-lg border border-gray-800">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs z-10"
          >
            <div>Size: <code class="text-emerald-400">${this.cols}x${this.rows}</code></div>
          </div>

          <vibe-terminal
            ${tt(this.terminalRef)}
            .cols=${this.cols}
            .rows=${this.rows}
            @terminal-input=${this.handleTerminalInput}
            @terminal-resize=${this.handleTerminalResize}
            style="width: 100%; height: 100%;"
          ></vibe-terminal>

          <div class="absolute bottom-4 left-4 right-4 flex gap-2 z-10">
            <input
              type="text"
              placeholder="Type custom text to send..."
              class="flex-1 px-3 py-2 bg-black/80 text-foreground border border-gray-800 rounded font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-emerald-400"
              .value=${this.inputText}
              @input=${e=>{this.inputText=e.target.value}}
              @keydown=${e=>{e.key==="Enter"&&this.sendCustomInput()}}
            />
            <button
              @click=${this.sendCustomInput}
              class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-background rounded font-medium text-sm transition-colors"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    `}};O([K()],be.prototype,"cols",2),O([K()],be.prototype,"rows",2),O([K()],be.prototype,"inputText",2),be=O([le("terminal-test")],be);He();He();var $e=ce("monaco-loader"),ti=!1,ot=null;async function Ni(){return ot||(ot=new Promise((S,i)=>{let e=document.createElement("script");e.src="/monaco-editor/vs/loader.js",e.onload=()=>{window.require.config({paths:{vs:"/monaco-editor/vs"}}),window.MonacoEnvironment={getWorker:(n,d)=>new Worker("data:,")},window.require(["vs/editor/editor.main"],()=>{$e.debug("Monaco Editor loaded via AMD"),S()})},e.onerror=()=>{i(new Error("Failed to load Monaco loader script"))},document.head.appendChild(e)}),ot)}async function ii(){if(!ti)try{$e.debug("Loading Monaco Editor..."),window.monaco||await Ni(),$e.debug("Initializing Monaco Editor...");let S=window.monaco;S.languages.register({id:"shell"}),S.languages.setMonarchTokensProvider("shell",{tokenizer:{root:[[/^#.*$/,"comment"],[/\$\w+/,"variable"],[/\b(echo|cd|ls|grep|find|chmod|mkdir|rm|cp|mv|touch|cat|sed|awk|curl|wget|git|pnpm|npm|yarn|docker|kubectl)\b/,"keyword"],[/"([^"\\]|\\.)*"/,"string"],[/'([^'\\]|\\.)*'/,"string"]]}}),S.editor.setTheme("vs-dark"),ti=!0,$e.debug("Monaco Editor initialized successfully")}catch(S){throw $e.error("Failed to initialize Monaco Editor:",S),S}}var Ws=window.monaco;var Ee=ce("monaco-editor"),G=class extends Z{constructor(){super(...arguments);this.content="";this.originalContent="";this.modifiedContent="";this.language="";this.filename="";this.readOnly=!1;this.mode="normal";this.showModeToggle=!1;this.options={};this.isLoading=!0;this.diffMode="sideBySide";this.containerWidth=0;this.containerRef=et();this.editor=null;this.resizeObserver=null;this.monacoLoaded=!1}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),await this.loadMonaco(),this.setupResizeObserver(),await this.updateComplete,this.containerRef.value&&!this.editor&&!this.isLoading&&await this.createEditor()}disconnectedCallback(){super.disconnectedCallback(),this.disposeEditor(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}async loadMonaco(){if(this.monacoLoaded||window.monaco){this.monacoLoaded=!0,this.isLoading=!1;return}try{Ee.debug("Loading Monaco Editor..."),await ii(),this.monacoLoaded=!0,this.isLoading=!1,Ee.debug("Monaco Editor loaded successfully")}catch(e){Ee.error("Failed to load Monaco Editor:",e),this.isLoading=!1}}async waitForMonaco(e=1e4){let n=Date.now();for(;!window.monaco;){if(Date.now()-n>e)throw new Error("Monaco Editor failed to load within timeout");await new Promise(d=>setTimeout(d,100))}}setupResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{for(let n of e){if(this.containerWidth=n.contentRect.width,this.mode==="diff"&&this.editor){let b=this.containerWidth<768?"inline":"sideBySide";b!==this.diffMode&&(this.diffMode=b,this.recreateEditor())}this.editor&&this.editor.layout()}}),this.containerRef.value&&this.resizeObserver.observe(this.containerRef.value)}async updated(e){super.updated(e),(e.has("mode")||e.has("content")&&!this.editor||e.has("originalContent")&&this.mode==="diff"||e.has("modifiedContent")&&this.mode==="diff")&&!this.isLoading&&this.containerRef.value?await this.recreateEditor():this.editor&&!this.isLoading&&(e.has("content")&&this.mode==="normal"&&this.updateContent(),(e.has("language")||e.has("filename"))&&this.updateLanguage(),e.has("readOnly")&&this.updateReadOnly())}async recreateEditor(){this.disposeEditor(),await this.createEditor()}async createEditor(){if(!(!this.containerRef.value||!window.monaco))try{this.setupTheme();let e={theme:"vs-dark",automaticLayout:!0,fontSize:14,fontFamily:"'Fira Code', Menlo, Monaco, 'Courier New', monospace",fontLigatures:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderWhitespace:"selection",readOnly:this.readOnly,folding:!0,foldingStrategy:"indentation",foldingHighlight:!0,showFoldingControls:"always",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!1,...this.options};if(this.mode==="diff"){let n={readOnly:!0,automaticLayout:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},renderWhitespace:"selection",renderSideBySide:this.diffMode==="sideBySide",ignoreTrimWhitespace:!1};this.editor=window.monaco.editor.createDiffEditor(this.containerRef.value,n);let d=this.detectLanguage(),b=Date.now(),y=`${this.filename||"untitled"}-${b}`,r=window.monaco.editor.createModel(this.originalContent||"",d,window.monaco.Uri.parse(`file:///${y}#original`)),l=window.monaco.editor.createModel(this.modifiedContent||"",d,window.monaco.Uri.parse(`file:///${y}#modified`));Ee.debug("Creating diff editor");let _=this.editor;_.setModel({original:r,modified:l});let p=()=>{this.editor&&this.editor.layout()},s=_.onDidUpdateDiff(()=>{p(),s.dispose()});setTimeout(p,200)}else this.editor=window.monaco.editor.create(this.containerRef.value,{...e,value:this.content,language:this.detectLanguage()}),this.readOnly||(this.editor.addCommand(window.monaco.KeyMod.CtrlCmd|window.monaco.KeyCode.KeyS,()=>{this.handleSave()}),this.editor.onDidChangeModelContent(()=>{let n=this.editor?.getValue()||"";this.dispatchEvent(new CustomEvent("content-changed",{detail:{content:n},bubbles:!0,composed:!0}))}));Ee.debug(`Created ${this.mode} editor`)}catch(e){Ee.error("Failed to create editor:",e)}}setupTheme(){window.monaco&&window.monaco.editor.setTheme("vs-dark")}detectLanguage(){if(this.language)return this.language;if(this.filename){let e=this.filename.split(".").pop()?.toLowerCase();return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",json:"json",html:"html",htm:"html",css:"css",scss:"scss",sass:"sass",less:"less",py:"python",rb:"ruby",go:"go",rs:"rust",java:"java",c:"c",cpp:"cpp",cs:"csharp",php:"php",swift:"swift",kt:"kotlin",scala:"scala",r:"r",sql:"sql",sh:"shell",bash:"shell",zsh:"shell",fish:"shell",ps1:"powershell",yml:"yaml",yaml:"yaml",xml:"xml",md:"markdown",markdown:"markdown",dockerfile:"dockerfile",makefile:"makefile",gitignore:"gitignore"}[e||""]||"plaintext"}return"plaintext"}updateContent(){if(!this.editor||this.mode==="diff")return;this.editor.getValue()!==this.content&&this.editor.setValue(this.content)}updateLanguage(){if(!this.editor||!window.monaco)return;let e=this.detectLanguage();if(this.mode==="normal"){let n=this.editor.getModel();n&&window.monaco.editor.setModelLanguage(n,e)}else{let n=this.editor,d=n.getOriginalEditor().getModel(),b=n.getModifiedEditor().getModel();d&&window.monaco.editor.setModelLanguage(d,e),b&&window.monaco.editor.setModelLanguage(b,e)}}updateReadOnly(){this.editor&&(this.mode==="normal"?this.editor.updateOptions({readOnly:this.readOnly}):this.editor.getModifiedEditor().updateOptions({readOnly:this.readOnly}))}handleSave(){if(this.readOnly||!this.editor||this.mode==="diff")return;let e=this.editor.getValue();this.dispatchEvent(new CustomEvent("save",{detail:{content:e},bubbles:!0,composed:!0}))}toggleDiffMode(){if(this.mode!=="diff")return;this.diffMode=this.diffMode==="inline"?"sideBySide":"inline";let e="",n="";if(this.editor){let b=this.editor.getModel();b&&(e=b.original?.getValue()||this.originalContent||"",n=b.modified?.getValue()||this.modifiedContent||"")}this.originalContent=e,this.modifiedContent=n,this.recreateEditor()}disposeEditor(){if(this.editor){if(this.mode==="diff"){let e=this.editor,n=e.getModel();e.setModel(null),n&&setTimeout(()=>{n.original?.dispose(),n.modified?.dispose()},0)}this.editor.dispose(),this.editor=null}}render(){return Q`
      <div
        class="monaco-editor-root"
        style="display: block; width: 100%; height: 100%; position: relative;"
      >
        <div
          class="editor-container"
          ${tt(this.containerRef)}
          style="width: 100%; height: 100%; position: relative; background: #1e1e1e;"
        >
          ${this.isLoading?Q`
                <div
                  class="loading"
                  style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-family: ui-monospace, monospace;"
                >
                  Loading editor...
                </div>
              `:""}
          ${this.showModeToggle&&this.mode==="diff"&&!this.isLoading?Q`
                <button
                  class="mode-toggle"
                  style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"
                  @click=${this.toggleDiffMode}
                  title="Toggle between inline and side-by-side diff"
                  @mouseenter=${e=>{let n=e.target;n.style.background="rgba(255, 255, 255, 0.2)",n.style.borderColor="rgba(255, 255, 255, 0.3)"}}
                  @mouseleave=${e=>{let n=e.target;n.style.background="rgba(255, 255, 255, 0.1)",n.style.borderColor="rgba(255, 255, 255, 0.2)"}}
                >
                  ${this.diffMode==="inline"?"Side by Side":"Inline"}
                </button>
              `:""}
        </div>
      </div>
    `}};O([z({type:String})],G.prototype,"content",2),O([z({type:String})],G.prototype,"originalContent",2),O([z({type:String})],G.prototype,"modifiedContent",2),O([z({type:String})],G.prototype,"language",2),O([z({type:String})],G.prototype,"filename",2),O([z({type:Boolean})],G.prototype,"readOnly",2),O([z({type:String})],G.prototype,"mode",2),O([z({type:Boolean})],G.prototype,"showModeToggle",2),O([z({type:Object})],G.prototype,"options",2),O([K()],G.prototype,"isLoading",2),O([K()],G.prototype,"diffMode",2),O([K()],G.prototype,"containerWidth",2),G=O([le("monaco-editor")],G);var re=class extends Z{constructor(){super(...arguments);this.mode="diff";this.readOnly=!1;this.showModeToggle=!0;this.language="typescript";this.content="";this.originalContent="";this.modifiedContent="";this.savedContent="";this.sampleCode={typescript:`// TypeScript Example
interface User {
  id: number;
  name: string;
  email: string;
  isActive: boolean;
}

class UserService {
  private users: User[] = [];

  async getUser(id: number): Promise<User | undefined> {
    return this.users.find(user => user.id === id);
  }

  async createUser(user: Omit<User, 'id'>): Promise<User> {
    const newUser: User = {
      ...user,
      id: this.users.length + 1
    };
    this.users.push(newUser);
    return newUser;
  }
}

export default UserService;`,javascript:`// JavaScript Example
class Calculator {
  constructor() {
    this.result = 0;
  }

  add(a, b) {
    this.result = a + b;
    return this.result;
  }

  subtract(a, b) {
    this.result = a - b;
    return this.result;
  }

  multiply(a, b) {
    this.result = a * b;
    return this.result;
  }

  divide(a, b) {
    if (b === 0) {
      throw new Error('Division by zero');
    }
    this.result = a / b;
    return this.result;
  }
}

module.exports = Calculator;`,python:`# Python Example
import asyncio
from typing import List, Optional

class TaskManager:
    def __init__(self):
        self.tasks: List[asyncio.Task] = []
        self.results: List[any] = []
    
    async def add_task(self, coro):
        """Add a coroutine as a task"""
        task = asyncio.create_task(coro)
        self.tasks.append(task)
        return task
    
    async def wait_all(self) -> List[any]:
        """Wait for all tasks to complete"""
        if not self.tasks:
            return []
        
        self.results = await asyncio.gather(*self.tasks)
        return self.results
    
    def cancel_all(self):
        """Cancel all pending tasks"""
        for task in self.tasks:
            if not task.done():
                task.cancel()

# Example usage
async def main():
    manager = TaskManager()
    await manager.add_task(asyncio.sleep(1))
    await manager.wait_all()`,json:`{
  "name": "monaco-editor-test",
  "version": "1.0.0",
  "description": "Monaco Editor test component",
  "dependencies": {
    "monaco-editor": "^0.52.2",
    "lit": "^3.3.0"
  },
  "scripts": {
    "test": "echo 'Error: no test specified' && exit 1",
    "build": "tsc && vite build",
    "dev": "vite"
  },
  "keywords": ["monaco", "editor", "test"],
  "author": "VibeTunnel Team",
  "license": "MIT"
}`}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.loadSampleContent()}loadSampleContent(){let e=this.sampleCode[this.language]||this.sampleCode.typescript;this.content=e,this.originalContent=e,this.modifiedContent=`${e}

// Modified by user
console.log("Changes made!");`}handleModeChange(e){this.mode=e,this.loadSampleContent()}handleLanguageChange(e){let n=e.target;this.language=n.value,this.loadSampleContent()}handleSave(e){this.savedContent=e.detail.content,console.log("Content saved:",this.savedContent),alert("Content saved! Check console for details.")}handleContentChanged(e){console.log("Content changed:",e.detail.content)}render(){return Q`
      <div class="h-screen flex flex-col bg-background text-foreground">
        <div class="bg-surface border-b border-gray-800 p-4">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Monaco Editor Test</h1>
          <div class="flex gap-3 flex-wrap items-center">
            <span class="text-sm text-gray-400">Mode:</span>
            <button
              class="${this.mode==="normal"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="normal"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("normal")}
            >
              Normal
            </button>
            <button
              class="${this.mode==="diff"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="diff"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("diff")}
            >
              Diff
            </button>

            <span class="text-sm text-gray-400 ml-4">Language:</span>
            <select
              @change=${this.handleLanguageChange}
              .value=${this.language}
              class="px-3 py-1.5 bg-gray-800 text-foreground border border-gray-700 hover:border-emerald-400 rounded text-sm cursor-pointer focus:outline-none focus:border-emerald-400"
            >
              <option value="typescript">TypeScript</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="json">JSON</option>
            </select>

            <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
              <input
                type="checkbox"
                .checked=${this.readOnly}
                @change=${e=>{this.readOnly=e.target.checked}}
                class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
              />
              <span>Read Only</span>
            </label>

            ${this.mode==="diff"?Q`
                  <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
                    <input
                      type="checkbox"
                      .checked=${this.showModeToggle}
                      @change=${e=>{this.showModeToggle=e.target.checked}}
                      class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
                    />
                    <span>Show Mode Toggle</span>
                  </label>
                `:""}
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden border border-gray-800 m-4 rounded-lg">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs z-10"
          >
            <div>Mode: <code class="text-emerald-400">${this.mode}</code></div>
            <div>Language: <code class="text-emerald-400">${this.language}</code></div>
            <div>Read Only: <code class="text-emerald-400">${this.readOnly}</code></div>
          </div>

          <monaco-editor
            .mode=${this.mode}
            .content=${this.content}
            .originalContent=${this.originalContent}
            .modifiedContent=${this.modifiedContent}
            .language=${this.language}
            .readOnly=${this.readOnly}
            .showModeToggle=${this.showModeToggle}
            @save=${this.handleSave}
            @content-changed=${this.handleContentChanged}
            style="width: 100%; height: 100%;"
          ></monaco-editor>
        </div>
      </div>
    `}};O([K()],re.prototype,"mode",2),O([K()],re.prototype,"readOnly",2),O([K()],re.prototype,"showModeToggle",2),O([K()],re.prototype,"language",2),O([K()],re.prototype,"content",2),O([K()],re.prototype,"originalContent",2),O([K()],re.prototype,"modifiedContent",2),O([K()],re.prototype,"savedContent",2),re=O([le("monaco-editor-test")],re);
/*! Bundled license information:

@lit/reactive-element/css-tag.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/reactive-element.js:
lit-html/lit-html.js:
lit-element/lit-element.js:
@lit/reactive-element/decorators/custom-element.js:
@lit/reactive-element/decorators/property.js:
@lit/reactive-element/decorators/state.js:
@lit/reactive-element/decorators/event-options.js:
@lit/reactive-element/decorators/base.js:
@lit/reactive-element/decorators/query.js:
@lit/reactive-element/decorators/query-all.js:
@lit/reactive-element/decorators/query-async.js:
@lit/reactive-element/decorators/query-assigned-nodes.js:
lit-html/directive.js:
lit-html/async-directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/is-server.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-assigned-elements.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
lit-html/directives/ref.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
